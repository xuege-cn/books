{"./":{"url":"./","title":"Introduction","keywords":"","body":"Introduction Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-07-03 16:08:07 "},"knowledge/":{"url":"knowledge/","title":"çŸ¥è¯†æ˜Ÿçƒ","keywords":"","body":"çŸ¥è¯†æ˜Ÿçƒ ðŸŒ è¿™é‡Œè®°å½•äº†å„ç§çŸ¥è¯†åˆ†ç±» Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-09-27 10:37:32 "},"knowledge/webpack/":{"url":"knowledge/webpack/","title":"Webpack","keywords":"","body":"webpack Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-07-27 11:22:05 "},"knowledge/webpack/1/1.html":{"url":"knowledge/webpack/1/1.html","title":"å…¬å…±æ¨¡å—ä»£ç å¦‚ä½•æå–ï¼Ÿ","keywords":"","body":" è§£ç­” æœ‰ä¸‰ç§æ‰“åŒ…æ–¹å¼ï¼š commonsChunkPlugin splitChunksPlugin dll commonsChunkPlugin ä½¿ç”¨æ–¹æ³•ï¼š entryè®¾ç½®vendorï¼š entry: { entryA: './a/entryA', entryB: './b/entryB', entryC: './c/entryC', vendor: ['vue', 'vuex', 'axios'] }, plugins: [ new webpack.optimize.CommonsChunkPlugin({ name: 'vendor' }) ] ç¼ºç‚¹ å…¬å…±ä»£ç å†—ä½™ï¼šcommonsChunkPluginæŠŠå…¬å…±åŒ…æ‰“æˆä¸€ä¸ªåŒ…ï¼Œå…¥å£Aåªç”¨äº†vueï¼Œvuexï¼Œä½†ä¸‹è½½çš„å…¬å…±åŒ…ä¸­ä¹Ÿæœ‰axios å¼‚æ­¥ç»„ä»¶é‡å¤æ‰“åŒ… spliChunksPlugin ä½¿ç”¨æ–¹æ³•ï¼š optimization: { minimize: true, splitChunks: { chunks: \"all\", minChunks: 1, maxAsyncRequests: 20, maxInitialRequests: 10, name: true, minSize: 30000, } }, æŠ½ç¦»ä»£ç æ˜¯æœ‰æ¡ä»¶çš„ æŠ½ç¦»ä»£ç éœ€è¦å¤§äºŽ30KBã€minSize: 3000ã€‘ æŒ‰éœ€åŠ è½½åº”ç”¨çš„ä»£ç ï¼Œå¹¶è¡Œè¯·æ±‚çš„æ•°é‡ä¸å¤šäºŽ5æ¬¡ã€maxAsyncRequest: 5ã€‘ åˆå§‹åŒ–åŠ è½½çš„ä»£ç å—ï¼Œå¹¶è¡Œè¯·æ±‚ä¸å¤šäºŽ3æ¬¡ã€maxInitialRequest: 3ã€‘ DLLPlugin ä½¿ç”¨æ–¹æ³•ï¼š webpack.vendor.config.js plugins: [ entry: { vue: ['vue'], vuex: ['vuex'] }, new webpack.DllPlugin({ name: '_dll_[name]', path: path.resolve(__dirname, './dll/[name].manifest.json'), }) ] webpack.app.config.jsä½¿ç”¨å¼•ç”¨ plugins: [ new webpack.DllReferencePlugin({ context: __dirname, manifest: require('./dll/vue.manifest.json'), }) ] æ‰‹åŠ¨é…ç½®ï¼Œæ–°å¼€ä¸€ä¸ªwebpackæ¥æž„å»ºå…¬å…±åŒ… Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-07-27 16:21:58 "},"knowledge/webpack/2/1.html":{"url":"knowledge/webpack/2/1.html","title":"æé«˜webpackæž„å»ºé€Ÿåº¦","keywords":"","body":" è§£ç­” é‡åŒ–å·¥å…·ï¼šspeed-measure-webpack-plugin æ‰“åŒ…ç²¾å‡†åŒ¹é…ï¼š exclude/include resolve module extension module noParse externals IgnorePlugin é¿å…é‡å¤æ‰“åŒ… splitChunks DllPlugin å¤šæ ¸æ‰“åŒ… happypack thread-loader terser-webpack-plugin ç¼“å­˜ cache-loader HardSourceWebpackPlugin webpackè‡ªèº«å®žçŽ°çš„ä¼˜åŒ– tree shaking speed-measure-webpack-pluginé‡åŒ– è¿™ä¸ªæ’ä»¶ä¼šç»Ÿè®¡æ¯ä¸ªæ’ä»¶å’Œloaderæ‰€èŠ±è´¹çš„æ—¶é—´ const SpeedMeasurePlugin = require(\"speed-measure-webpack-plugin\"); const smp = new SpeedMeasurePlugin(); const webpackConfig = {} module.exports = smp.wrap(webpackConfig) æŒ‡å®šexclude/include å¯¹äºŽloaderæŒ‡å®šincludeç›®å½•ï¼Œå¯ä»¥æœ‰æ•ˆé¿å…ç¼–è¯‘ä¸å¿…è¦çš„ä»£ç  { module: { rules: [ { test: /\\.js[x]?$/, use: ['babel-loader'], include: [path.resolve(__dirname, 'src')] } ] } } webpackè‡ªç”±é…ç½®ä¼˜åŒ– noParseï¼Œresolveï¼Œexternals { module: { noParse: /jquery|lodash/ }, resolve: { modules: path.resolve(__dirname, 'node_modules'), extensions: ['.js', '.json'] }, externals: { 'jquery': 'jQuery' } } cache-loader åœ¨ä¸€äº›æ€§èƒ½å¼€é”€è¾ƒå¤§çš„loaderä¹‹å‰åŠ cache-loaderï¼Œå°†ç»“æžœç¼“å­˜åœ¨ç£ç›˜ä¸­ { module: { rules: [ { test: /\\.js[x]?$/, use: ['cache-loader', 'babel-loader'] } ] } } happypack å¤šæ ¸å¤„ç† å¤šä¸ªå­è¿›ç¨‹å¹¶å‘æ‰§è¡Œï¼Œå­è¿›ç¨‹å¤„ç†å®ŒåŽå†æŠŠç»“æžœå‘ç»™ä¸»è¿›ç¨‹ const Happypack = require('happypack') { module: { rules: [ { test: /\\.js[x]?$/, use: 'Happypack/loader?id=js', include: [path.resolve(__dirname, 'src')] }, { test: /\\.css$/, use: 'Happypack/loader?id=css', include: [ path.resolve(__dirname, 'src'), path.resolve(__dirname, 'node_modules', 'bootstrap', 'dist') ] } ] }, plugins: [ new Happypack({ id: 'js', //å’Œruleä¸­çš„id=jså¯¹åº” //å°†ä¹‹å‰ rule ä¸­çš„ loader åœ¨æ­¤é…ç½® use: ['babel-loader'] //å¿…é¡»æ˜¯æ•°ç»„ }), new Happypack({ id: 'css',//å’Œruleä¸­çš„id=csså¯¹åº” use: ['style-loader', 'css-loader','postcss-loader'], }) ] } thread-loader å¤šæ ¸æ‰“åŒ… æŠŠthread-loaderæ”¾ç½®åœ¨å…¶ä»–loaderä¹‹å‰ï¼Œä¼šå¼€å¯ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹è¿è¡Œé€Ÿåº¦è·Ÿhappypackå·®ä¸å¤šï¼Œä¸è¿‡ä¼˜ç‚¹æ˜¯é…ç½®æ›´ç®€å• { module: { //æˆ‘çš„é¡¹ç›®ä¸­,babel-loaderè€—æ—¶æ¯”è¾ƒé•¿ï¼Œæ‰€ä»¥æˆ‘ç»™å®ƒé…ç½® thread-loader rules: [ { test: /\\.jsx?$/, use: ['thread-loader', 'cache-loader', 'babel-loader'] } ] } } terser-webpack-plugin å¤šæ ¸åŽ‹ç¼© webpacké»˜è®¤å¼€å¯äº†å¤šè¿›ç¨‹å’Œç¼“å­˜ const TerserPlugin = require('terser-webpack-plugin'); module.exports = { optimization: { minimize: true, minimizer: [new TerserPlugin()], }, }; HardSourceWebpackPlugin ä¸­é—´ç¼“å­˜ ä¸­é—´ç¼“å­˜æé«˜éžé¦–æ¬¡æž„å»ºé€Ÿåº¦ var HardSourceWebpackPlugin = require('hard-source-webpack-plugin'); module.exports = { plugins: [ new HardSourceWebpackPlugin() ] } IgnorePluginé¿å…æœ¬åœ°åŒ–æ–‡ä»¶å’Œæ ¸å¿ƒæ–‡ä»¶ä¸€èµ·æ‰“åŒ… æœ‰äº›é¡¹ç›®æ¯”å¦‚momentï¼Œä¼šæŠŠæœ¬åœ°åŒ–æ–‡ä»¶å’Œæ ¸å¿ƒæ–‡ä»¶ä¸€èµ·æ‰“åŒ… module.exports = { plugins: [ new webpack.IgnorePlugin(/^\\.\\/locale$/, /moment$/) ] } // ä½¿ç”¨åˆ°æœ¬åœ°åŒ–çš„ åœ°æ–¹ import moment from 'moment'; import 'moment/locale/zh-cn'; DllPlugin æŠ½ç¦»å…¬å…±ä»£ç  è§ä¸Šä¸€ç¯‡ã€å…¬å…±æ¨¡å—ä»£ç å¦‚ä½•æå–ï¼Ÿã€‘ splitChunks è§ä¸‹ä¸€ç¯‡ã€webpack v3åˆ°v4ä¸»è¦åŒºåˆ«ã€‘ webpackè‡ªèº«ä¼˜åŒ– tree shaking tree shakingåªæ˜¯ä¸ºäº†ä¼˜åŒ–ä»£ç ï¼Œä¸èƒ½ä½¿ä»£ç æŠ¥é”™ä½¿ç”¨äº†es6çš„importï¼Œç”Ÿäº§çŽ¯å¢ƒä¼šè‡ªåŠ¨ç§»é™¤æ²¡æœ‰ä½¿ç”¨åˆ°çš„ä»£ç  DCEï¼šDead Code eliminationï¼ˆæ— ç”¨ä»£ç åˆ é™¤ï¼‰ DCEæ¶ˆé™¤ï¼šé çš„æ˜¯uglifyåŽ‹ç¼© ä¸ºä»€ä¹ˆtree shakingåˆ ä¸æŽ‰ä»£ç  åªå¤„ç†å‡½æ•°å’Œé¡¶å±‚çš„import/exportå˜é‡ï¼Œä¸èƒ½æŠŠæ²¡ç”¨åˆ°çš„ç±»çš„æ–¹æ³•æ¶ˆé™¤æŽ‰ jsåŠ¨æ€è¯­è¨€çš„ç‰¹æ€§ä½¿å¾—é™æ€åˆ†æžå˜çš„å›°éš¾ Side Effectå¹¿æ³›å­˜åœ¨ æ¯”å¦‚ä¸‹é¢çš„ðŸ‘‡ï¼Œé™æ€ä»£ç æ˜¯æ— æ³•åˆ†æžçš„ï¼š function Menu() { } Menu.prototype.show = function() { } var a = 'Arr' + 'ay' var b if(a == 'Array') { b = Array } else { b = Menu } b.prototype.unique = function() { // å°† array ä¸­çš„é‡å¤å…ƒç´ åŽ»é™¤ } export default Menu; babelç¼–è¯‘classæ—¶æ˜¯é€šè¿‡_createClassæ–¹æ³•ï¼Œç±»å±žæ€§æ—¶é€šè¿‡Object.definePropertyèµ‹å€¼çš„ ä¸ºä»€ä¹ˆè¿™æ ·å®žçŽ°ï¼Ÿ=> ç±»å†…éƒ¨å£°æ˜Žçš„æ–¹æ³•ï¼Œæ˜¯ä¸å¯æžšä¸¾çš„ï¼Œè€Œé€šè¿‡åŽŸåž‹é“¾å£°æ˜Žçš„æ–¹æ³•æ˜¯å¯ä»¥æžšä¸¾çš„ï¼Œbabelä¸ºäº†ç¬¦åˆes6çœŸæ­£çš„è¯­ä¹‰ babelå®½æ¾æ¨¡å¼ { \"presets\": [[\"env\", { \"loose\": false }]] } babelçš„å®½æ¾æ¨¡å¼ï¼Œç±»å±žæ€§æ–¹æ³•å°†ä¼šç¼–è¯‘æˆç›´æŽ¥åœ¨åŽŸåž‹é“¾ä¸Šå£°æ˜Žæ–¹æ³•ã€‚ tree shakingä¸Šèƒ½å¤Ÿå°½åŠ›çš„äº‹ å°½é‡ä¸å†™å¸¦æœ‰å‰¯ä½œç”¨çš„ä»£ç ï¼Œæ¯”å¦‚ç¼–å†™äº†è‡ªæ‰§è¡Œå‡½æ•°ï¼Œåˆåœ¨å‡½æ•°é‡Œä½¿ç”¨äº†å¤–éƒ¨å˜é‡ å¯ä»¥å¼€å¯babelçš„looseï¼ˆå®½æ¾ï¼‰æ¨¡å¼ å¦‚æžœæ˜¯å¼€å‘JavaScriptåº“ï¼Œè¯·ä½¿ç”¨rollup å¦‚æžœæ˜¯jsåº“ï¼Œéš¾ä»¥é¿å…å‰¯ä½œç”¨ä»£ç ï¼Œå¯ä»¥å°†åŠŸèƒ½å‡½æ•°æˆ–è€…ç»„ä»¶æ‰“åŒ…æˆå•ç‹¬çš„æ–‡ä»¶æˆ–ç›®å½• Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-07-27 22:15:54 "},"knowledge/webpack/3/1.html":{"url":"knowledge/webpack/3/1.html","title":"webpack v3åˆ°v4ä¸»è¦åŒºåˆ«","keywords":"","body":" è§£ç­” è‡ªåŠ¨è®¾ç½®process.env.NODE_EVNï¼š-mode development UglifyJsPluginã€‚ç›´æŽ¥é…ç½®{ optimization: { minimize: true } } CommonsChunkPluginåºŸå¼ƒï¼ŒSplitChunksPluginå–è€Œä»£ä¹‹ splitChunks chunksï¼šè¡¨ç¤ºå“ªäº›ä»£ç éœ€è¦ä¼˜åŒ– initialï¼ˆåˆå§‹å—ï¼‰ asyncï¼ˆæŒ‰éœ€åŠ è½½å—ï¼‰ allï¼ˆå…¨éƒ¨ï¼‰ minSizeï¼šåŽ‹ç¼©å‰çš„æœ€å°æ¨¡å—å¤§å°ï¼Œé»˜è®¤30KB minChunksï¼šå¼•ç”¨æ¬¡æ•°ã€‚é»˜è®¤ä¸º1 maxAsyncRequestsï¼šæŒ‰éœ€åŠ è½½æ—¶å€™æœ€å¤§çš„å¹¶è¡ŒåŠ è½½è¯·æ±‚æ•°ï¼Œé»˜è®¤ä¸º5 maxInitialRequests: ä¸€ä¸ªå…¥å£æœ€å¤§çš„å¹¶è¡Œè¯·æ±‚æ•°ï¼Œé»˜è®¤ä¸º3 nameï¼šæ‹†åˆ†å‡ºæ¥å—çš„åå­— cacheGroupsï¼šç¼“å­˜ç»„ testï¼šæ­£åˆ™åŒ¹é…å“ªäº›æ¨¡å— priorityï¼šç¼“å­˜ç»„æ‰“åŒ…çš„å…ˆåŽä¼˜å…ˆçº§ reuseExstingChunkï¼šå½“å‰ä»£ç å—å·²æœ‰ï¼Œå°±ä¸å†äº§ç”Ÿä¸€ä¸ªæ–°çš„ä»£ç å— ä½¿ç”¨splitChunkså®žçŽ°CommonsChunkPluginçš„åŠŸèƒ½ åªæ‰“åŒ…reactï¼š optimization: { splitChunks: { chunks: 'all', cacheGroups: { vendors: { test: /react/, name: 'vendors' } } } } æ‰“åŒ…vendorå…¥å£åŒ…æ‹¬çš„ä¾èµ–ï¼š { entry: { vendor: ['react', 'react-dom'], } optimization: { splitChunks: { chunks: 'all', cacheGroups: { vendors: { name: 'vendors', chunk: 'initial' } } } } } splitChunksç¼ºç‚¹ ç¬¬ä¸€æ¬¡æ‰“åŒ…vueï¼Œvuexï¼ŒåŽé¢å¢žåŠ äº†lodashï¼Œæµè§ˆå™¨ä¸­çš„vendorä¼šå¤±æ•ˆ Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-07-27 22:03:39 "},"knowledge/webpack/4/1.html":{"url":"knowledge/webpack/4/1.html","title":"å¯¹ tree-shaking çš„äº†è§£","keywords":"","body":" è§£ç­” 1.webpackç”Ÿäº§æ¨¡å¼ä¸‹é»˜è®¤å¼€å¯tree-shaking 2.ç”±äºŽbabelæŠŠclassç­‰å°è£…æˆIIFEï¼Œå­˜åœ¨å‰¯ä½œç”¨å¯¼è‡´tree-shakingå¤±æ•ˆ 3.æ‰‹åŠ¨è®¾ç½®æ— å‰¯ä½œç”¨ï¼š 3.1moduleä¸‹çš„rule.sideEffects: false 3.2package.jsonä¸‹çš„sideEffects: false 4.ä¾èµ–äºŽes6 importçš„é™æ€åˆ†æžï¼Œå‡½æ•°å¯ä»¥è¢«shaking 5.tree shakingçš„è¿‡ç¨‹å‘ç”Ÿåœ¨åŽ‹ç¼©é˜¶æ®µ webpackç”±äºŽuglifyçš„ç¼˜æ•…ï¼Œå¯¼è‡´babelå®½æ¾æ¨¡å¼ä¸‹çš„classä¹Ÿæ— æ³•è¢«shaking uglifyå¯ä»¥è®¾ç½®pure_gettersæ¥é¿å…èŽ·å–å¯¹è±¡å±žæ€§çš„å‰¯ä½œç”¨ å‰¯ä½œç”¨ï¼š ä¸€ä¸ªå‡½æ•°ä¼šï¼Œæˆ–è€…å¯èƒ½ä¼šå¯¹å‡½æ•°å¤–éƒ¨å˜é‡äº§ç”Ÿå½±å“çš„è¡Œä¸º èŽ·å–å¯¹è±¡çš„å±žæ€§ä¹Ÿä¼šäº§ç”Ÿå‰¯ä½œç”¨ babelç¼–è¯‘ä¸€ä¸ªclass class Person { constructor(name){ this.name = name; } getName () { return this.name } } ç¼–è¯‘ä¹‹åŽðŸ‘‡ï¼š var _createClass = function (constructor, protoProps) { for (let descriptor of protoProps) { descriptor.enumerable = descriptor.enumerable || !1 descriptor.configurable = !0 Object.defineProperty(constructor.prototype, descriptor.key, descriptor) } } var Person = function () { function Person (name) { this.name = name; } _createClass(Person, [{ key: 'getName', value: function getName() { return this.name; } }]); return Person; }() babelä¸ºä»€ä¹ˆè¿™æ ·åšï¼Œè¦ç”¨definePropertyæ¥èµ‹å±žæ€§ï¼Œè€Œä¸æ˜¯å®šä¹‰ä¸€ä¸ªfunction Person, Person.prototype = { getName }ï¼šå› ä¸ºES6çš„ã€ç±»å†…éƒ¨å£°æ˜Žçš„æ–¹æ³•ï¼Œæ˜¯ä¸å¯æžšä¸¾çš„ï¼Œè€Œé€šè¿‡åŽŸåž‹é“¾å£°æ˜Žçš„æ–¹æ³•æ˜¯å¯ä»¥æžšä¸¾çš„ã€‘ babelæœ‰ä¸€ç§å®½æ¾æ¨¡å¼ï¼š { \"presets\": [[\"env\", { \"loose\": false }]] } å®½æ¾æ¨¡å¼ä¸‹classä¼šè¢«ç¼–è¯‘ä¸ºåŽŸåž‹é“¾çš„æ–¹å¼ï¼Œè¿™æ—¶ç”¨rollupæ‰“åŒ…classå¯ä»¥è¢«shakingæŽ‰ tree-shakingçš„æœ€ä½³å®žè·µ å°†æ¯ä¸€ä¸ªç»„ä»¶æˆ–è€…åŠŸèƒ½å‡½æ•°ï¼Œéƒ½æ‰“åŒ…æˆå•ç‹¬çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œæ¯”å¦‚Buttonå•ç‹¬æ‰“åŒ…ï¼Œå•ç‹¬å¯¼å‡ºï¼šbabel-import-plugin å°½é‡ä¸è¦å†™å¸¦æœ‰å‰¯ä½œç”¨çš„ä»£ç ï¼Œæ¯”å¦‚ç¼–å†™äº†IIFEï¼Œå‡½æ•°é‡Œåˆä½¿ç”¨äº†å¤–éƒ¨å˜é‡ å¯¹ES6è¯­ä¹‰ä¸æ˜¯ç‰¹åˆ«ä¸¥æ ¼çš„ï¼Œå¯ä»¥å¼€å¯babelçš„looseæ¨¡å¼ï¼Œrollup shakingèƒ½åŠ›æé«˜å¾ˆå¤š uglifyæœ‰pure_getter: trueçš„é…ç½®ï¼Œä¸è¿‡ä¸å»ºè®®ä½¿ç”¨ Reactçš„hooksæœ‰åˆ©äºŽtree shakingï¼Œå› ä¸ºtree shakingå¯¹å‡½æ•°çš„æ•ˆæžœæ›´å¥½ Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-07-29 20:00:58 "},"knowledge/webpack/5/1.html":{"url":"knowledge/webpack/5/1.html","title":"HMRåŽŸç†","keywords":"","body":" webpackçƒ­æ›´æ–°è‡ªå®šä¹‰å®žçŽ° æœåŠ¡ç«¯è¦åšä¸‰ä»¶äº‹ï¼š compiler ç›¸å…³å››ä»¶äº‹ compiler å¢žåŠ  done é’©å­å‡½æ•°ï¼Œç¼–è¯‘å®Œæˆè®°å½• hash å€¼ï¼Œå¹¶ socket å¹¿æ’­ æ›´æ–° compiler.options.entry æ³¨å…¥ webpack-dev-server/client.js å’Œ webpack/hot/dev-server.js è°ƒç”¨ compiler.hooks.entryOption.call(config.context, config.entry) æ›´æ–° entry compiler ä»¥ watch æ¨¡å¼å¯åŠ¨ compiler æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨ memory-fs å¯åŠ¨æœåŠ¡å™¨é…ç½®è·¯ç”± express æ–¹å¼å¯åŠ¨æœåŠ¡å™¨ é…ç½®è·¯ç”±ä¸­é—´ä»¶ æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨ memory-fs å¯åŠ¨ socket æœåŠ¡ ä»¥ server ä¸ºåŸºç¡€å¯åŠ¨socket.io ç›‘å¬è¿žæŽ¥ï¼Œä¿å­˜ socketï¼Œå¹¿æ’­ hash å’Œ ok å®¢æˆ·ç«¯è¦åšçš„ä¸‰ä»¶äº‹ï¼š æ³¨å…¥çš„ webpack-dev-server/client/index.js å»ºç«‹ socket è¿žæŽ¥ï¼Œç›‘å¬ hotï¼Œhashï¼Œok äº‹ä»¶ hash äº‹ä»¶ä¿å­˜ hash å€¼ hot äº‹ä»¶æ”¹å˜ hot å˜é‡ ok äº‹ä»¶ä¸­å‘å¸ƒ webpackHotUpdate äº‹ä»¶ æ³¨å…¥çš„ webpack/hot/dev-server.js è®¢é˜… webpackHotUpdate äº‹ä»¶ï¼Œå›žè°ƒä¸­æ‰§è¡Œ module.hot.checkï¼Œä¼ å…¥ hash å€¼ webpack æ‰“åŒ…ä»£ç  åœ¨ module å¯¹è±¡ä¸Šå¢žåŠ ä¸‰ä¸ªå±žæ€§ hot: { accept, check } parents children hotCreateRequire å°è£… webpack_requireï¼Œç»´æŠ¤ parents å’Œ children å±žæ€§ hotCheck å‘èµ· xhr è¯·æ±‚ ${hash}.hot-update.jsonï¼Œè¿”å›ž{ hash, c: { main: true } } åˆ›å»º script å‘èµ·æ–‡ä»¶è¡¥ä¸ jsonp è¯·æ±‚ ${chunkName}.${hash}.hot-update.js jsonp åŠ è½½è¿›å…¥ webpackHotUpdateï¼Œè¿”å›žæ•°æ®(chunkId, { chunkName: function () { æ–°ä»£ç  } }) æ›´æ–° modules ä¸­çš„è€ä»£ç  ä»Žç¼“å­˜ä¸­èŽ·å–å„ä¸ª chunk çš„è€ module åˆ é™¤ç¼“å­˜ä¸Šçš„è€ module ä»Žè€ module çš„çˆ¶ module ä¸Šæ‰¾åˆ° accept å›žè°ƒå¹¶æ‰§è¡Œ å…·ä½“ä»£ç å®žçŽ°ï¼šæˆ‘çš„ç¤ºä¾‹tipsï¼š è¡¥ä¸æ–‡ä»¶æ˜¯é€šè¿‡ webpack.HotModuleReplacementPlugin æ’ä»¶ç”Ÿæˆçš„ webpackçƒ­æ›´æ–°çš„ä½¿ç”¨ ä¸»æ–‡ä»¶: // index.js const input = document.createElement('input') document.body.append(input) const div = document.createElement('div') document.body.append(div) function render () { const data = require('./mock.js') div.innerHTML = data } render() if (module.hot) { module.hot.accept(['./mock.js'], render) } // mock.js module.exports = 'hello world' webpacké…ç½®æ–‡ä»¶ï¼š devServer: { hot: true } ä¾é module.hotä»¥åŠdevServer.hotå°±å¯ä»¥å®žçŽ°webpackçƒ­æ›´æ–°äº† webpackçƒ­æ›´æ–°æœåŠ¡ç«¯çš„å®žçŽ° æœåŠ¡ç«¯ä¹Ÿå³webpack-dev-serverï¼ŒæœåŠ¡ç«¯åšäº†å“ªäº›äº‹å‘¢ï¼Ÿ setupAppï¼Œåˆ›å»ºexpresså®žä¾‹ updateCompilerï¼Œä¼šå¾€å‰ç«¯jsä¸­æ³¨å…¥å¦å¤–ä¸¤ä¸ªjs setupHooksï¼Œç›‘å¬hooksç¼–è¯‘å®Œæˆäº‹ä»¶ï¼Œç¼–è¯‘å®Œæˆéœ€è¦å¹²ä»€ä¹ˆå‘¢ï¼Ÿ å­˜å‚¨hashå€¼ å¹¿æ’­æ‰€æœ‰socket hashå€¼ï¼Œä»¥åŠok setupDevMiddleware watchæ–¹å¼å¯åŠ¨compiler è¿”å›žè·¯ç”±ä¸­é—´ä»¶ routesï¼Œapp.useä¼ å…¥è·¯ç”±ä¸­é—´ä»¶ï¼Œè¿›è¡Œè·¯ç”± createServerï¼Œé€šè¿‡expresså®žä¾‹appåˆ›å»ºserver createSocketServerï¼Œé€šè¿‡serverå®žä¾‹åˆ›å»ºsocket.ioæœåŠ¡ ä¸‹é¢æ¥å®žçŽ°ä¸‹ï¼š webpack-dev-serverå¯åŠ¨æ–‡ä»¶ const Server = require('./server') const webpack = require('webpack') const config = require('webpack.config.js') const compiler = webpack(config) const server = new Server(compiler) server.listen(9090, () => { console.log('æœåŠ¡å™¨åœ¨ç«¯å£9090å¯åŠ¨äº†') }) setupApp åˆ›å»ºexpresså®žä¾‹ const express = require('express') setupApp () { this.app = express() } updateCompiler å¾€å®¢æˆ·ç«¯æ³¨å…¥js const path = require('path') function updateCompiler (compiler) { const config = compiler.options config.entry = { main: [ path.resolve(__dirname, './client/index.js'), path.resolve(__dirname, './hot/dev-server.js'), config.entry ] } } setupHooks æŒ‚è½½compiler.hooks.doneé’©å­å‡½æ•°ï¼Œæ‰“åŒ…å®Œæˆæ‰§è¡Œï¼š å­˜å‚¨hashå€¼ å‘å„ä¸ªsocketå¹¿æ’­ä¸¤ä¸ªäº‹ä»¶ï¼šhashï¼ŒoksetupHooks () { const { compiler } = this compiler.hooks.done.tap(stats => { this.currentHash = stats.hash this.clientSocketList.forEach(socket => { socket.emit('hash', stats.hash) socket.emit('ok') }) }) } setupDevMiddleware ä¸¤ä¸ªä½œç”¨ï¼š ä»¥watchæ–¹å¼å¯åŠ¨compiler è·¯ç”± æŠŠwebpackçš„æ–‡ä»¶è¾“å…¥ç³»ç»Ÿæ”¹ä¸ºmemory-fsï¼Œç›¸åŒè·¯ç”±è¯»å–ä¹Ÿä»Žmemory-fsè¯»å– this.middleware = this.setupDevMiddleware() const mime = require('mime') const path = require('path') const MemoryFs = require('memory-fs') setupDevMiddleware () { const { compiler } = this const staticDir = compiler.options.output.path compiler.watch({}, () => { console.log('compilerç›‘å¬æ¨¡å¼å¯åŠ¨') }) const fs = new MemoryFs() this.fs = compiler.outputFileSystem = fs return (req, res, next) => { let { url } = req if (url === '/favicon.ico') { res.senStatus(404) } url === '/' ? url = '/index.html' : null const filePath = path.resolve(staticDir, url) try { let statObj = this.fs.statSync(filePath) if (statObj.isFile()) { const content = this.fs.readFileSync(filePath) res.setHeader('Content-Type', mime.getType(filePath)) res.send(content) } else { res.senStatus(404) } } catch (e) { res.sendStatus(404) } } } routes è®¾ç½®è·¯ç”± routes () { const { app, middleware } = this app.use(middleware) } createServer createServer () { const { app } = this this.server = http.createServer(app) } createSocketServer createSocketServer () { const { server } = this const io = socketIO(server) io.on('connection', socket => { socket.emit('hash', this.currentHash) socket.emit('ok') this.clientSocketList.push(socket) io.on('disconnect', () => { const index = this.clientSocket.indexOf(socket) this.clientSocketList.spilce(index, 1) }) }) } Serveræž„é€ å‡½æ•° constructor () { this.setupApp(); updateCompiler(); this.clientSocketList = []; this.setupHooks(); this.setupDevMiddleware(); this.routes(); this.createServer(); this.createSocketServer(); } Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-09-23 17:38:11 "},"knowledge/webpack/6/1.html":{"url":"knowledge/webpack/6/1.html","title":"é…ç½®æ–‡ä»¶å®Œå…¨è§£æž","keywords":"","body":"é…ç½®æ–‡ä»¶å®Œå…¨è§£æž webpackå¯åŠ¨æ–‡ä»¶é…ç½® // é»˜è®¤ webpack.config.js æ–‡ä»¶ï¼Œä½¿ç”¨--configæŒ‡å®šå…¶ä»–æ–‡ä»¶ webpack --config example.config.js ä»¥ json æ ¼å¼è¾“å‡º webpack è¿è¡Œç»“æžœ webpack --json > stats.json context å…¥å£æ–‡ä»¶æ‰€å¤„ç›®å½•ç»å¯¹è·¯å¾„çš„å­—ç¬¦ä¸² context: path.resolve(__dirname, 'app') entry ä¸‰ç§æ–¹å¼ï¼šå­—ç¬¦ä¸²ï¼Œæ•°ç»„ï¼Œå¯¹è±¡ // å­—ç¬¦ä¸² entry: 'index.js' // æ•°ç»„ entry: ['index.js', 'main.js'] // å¯¹è±¡ entry: { pageOne: 'pageOne/index.js', pageTwo: 'pageTwo/index.js' } // åŠ¨æ€å…¥å£ // å‡½æ•° entry: () => './index.js' // promise entry: () => new Promise((resolve) => resolve(['./index.js', './main.js'])) webpack 5 ä¸­çš„æ”¹åŠ¨: Entry descriptor // Entry descriptor { entry: { main: { import: 'index.js', filename: 'pages/[name].js', chunkLoading: 'jsonp | import-scripts ï½œ require ï½œ async-mode' } } } chunkLoading jsonp æ‰“åŒ…å‡ºæ¥çš„ä»£ç ï¼šåŒ¿åè‡ªæ‰§è¡Œå‡½æ•° (() => { eval(\"console.log('index');\\n\\n//# sourceURL=webpack://webpack/./index.js?\"); })(); require | async-node output filenameï¼š[id].[name].[hash].[chunkhash].js pathï¼šç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„ publicPathï¼š'http://cdn.example.com/[hash]/' chunkFilename chunkLoadTimeout: import çš„ chunk è¿‡æœŸæ—¶é—´ crossOriginLoading: false | 'anonymous' | 'use-credentials' jsonpScriptType: 'text/javascript' | 'module' hotUpdateChunkFilename: '[id].[hash].hot-update.js' library: 'webpackNumbers' æ‰‹åŠ¨ script å¼•å…¥ jsï¼Œå¯ä»¥ä½¿ç”¨ webpackNumbers è®¿é—®é‡Œé¢çš„æ–¹æ³• output.auxiliaryComment auxiliaryComment é…åˆ libraryTarget ä¸€èµ·ä½¿ç”¨ auxiliaryComment ä¸ºå­—ç¬¦ä¸²æ—¶ï¼Œæ˜¯æ‰€æœ‰æ¨¡å¼æ¨¡å—éƒ½ä¼šå¯¼å‡º auxiliaryComment ä¸º jsonï¼Œç»†åˆ†å„ä¸ªæ¨¡å¼æ¨¡å—é…ç½®æ³¨é‡Š å­—ç¬¦ä¸²ï¼š output: { libraryTarget: 'umd', auxiliaryComment: 'Test Comment' } jsonæ ¼å¼ï¼š output: { libraryTarget: 'umd', auxiliaryComment: { root: 'Root Comment', commonjs: 'Commonjs Comment', commonjs2: 'Commonjs2 Comment', amd: 'AMD Comment' } } mode æœ‰ä¸¤ä¸ªå€¼ï¼šproductionï¼Œdevelopment ä¼šå°† definePlugin ä¸­ process.env.NODE_ENV å€¼è®¾ä¸º production æˆ– development å¯ç”¨ä¸åŒçš„ plugin æ¨¡å— chunk loader å‘ webpack æè¿°äº†å¦‚ä½•å¤„ç†éžåŽŸç”Ÿæ¨¡å— ä½¿ç”¨ enhanced-resolve è§£æžæ–‡ä»¶è·¯å¾„ target Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-11-13 17:58:52 "},"interview/webpack/":{"url":"interview/webpack/","title":"webpack","keywords":"","body":"webpack æ¯æ—¥ä¸€é¢˜ Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-10-10 10:49:13 "},"interview/webpack/1/1.html":{"url":"interview/webpack/1/1.html","title":"webpackåšè¿‡å“ªäº›ä¼˜åŒ–ï¼Ÿå¼€å‘æ•ˆçŽ‡ï¼Œæ‰“åŒ…ç­–ç•¥ç­‰","keywords":"","body":" è§£ç­” Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-11-10 16:58:14 "},"interview/webpack/2/1.html":{"url":"interview/webpack/2/1.html","title":"HtmlWebpackPlugin çš„é…ç½®","keywords":"","body":" è§£ç­” filename new HtmlWebpackPlugin({ filename: 'order/index.html' }) title new HtmlWebpackPlugin({ title: 'Hello Webpack' }) template new HtmlWebpackPlugin({ template: 'template.html' }) templateContent inline html templateParameters new HtmlwebpackPlugin({ templateParameters: { __base_style__: ' .app { red } ' } }) inject inject: true | false | head | body true è·Ÿ body æ•ˆæžœä¸€æ ·ï¼šåœ¨bodyæœ«å°¾æ³¨å…¥ falseï¼šä¸æ³¨å…¥ js headï¼šåœ¨ head ä¸­æ³¨å…¥ js publicPath è·Ÿ output publicPathï¼Œåœ¨è¾“å‡º js è·¯å¾„åŠ å…¥ publicPath scriptLoading blockingï¼š æ­£å¸¸æ³¨å…¥ js deferï¼šæ³¨å…¥ js æ·»åŠ  defer å±žæ€§ scriptLoading: blocking | defer favicon æ³¨å…¥ faviconï¼Œâš ï¸ ï¼šéœ€è¦æ˜¯æœ¬åœ°çš„ï¼Œä¼šå¸¦ä¸Š publicPath å‰ç¼€ minify åŽ‹ç¼©ï¼Œtrue | false hash js css icon éƒ½ä¼šå¸¦ä¸Š ?hashï¼Œå¯æœ‰æ•ˆæ¸…æ¥šç¼“å­˜ chunks æ³¨å…¥å“ªäº› js chunks: ['main'] chunksSortMode // æ’å…¥ html çš„å¾ˆå¤š chunksï¼Œå¦‚ä½•æŽ’åº chunks: ['index', 'main'], chunksSortMode: 'auto | manual' excludeChunks ä¸åŒ…å«çš„ chunks Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-11-09 15:03:00 "},"interview/webpack/3/1.html":{"url":"interview/webpack/3/1.html","title":"æœ‰å“ªäº›æœ‰ç”¨çš„ webpack æ’ä»¶","keywords":"","body":" Loader loader çš„ä½¿ç”¨æ–¹å¼ å¦‚æžœä¸åœ¨ webpack.config.js ä¸­é…ç½® loaderï¼Œé‚£ä¹ˆæ€Žä¹ˆä½¿ç”¨å‘¢ï¼Ÿ require('style-loader!css-loader!./index.css') file-loader å¤„ç†æ–‡ä»¶ æŠŠåŽŸå›¾ç‰‡æ‹·è´åˆ° distï¼Œæ–‡ä»¶åä¹Ÿä¼šå˜ å¯ä»¥å¤„ç†ä»»æ„äºŒè¿›åˆ¶æ•°æ® require('file-loader?outputPath=./images!./1.jepg') { test: /.png/, use: { loader: 'file-loader', options: { outputPath: '/images' } } } å…¨å±€æ³¨å…¥æ–¹æ¡ˆäºŒï¼šexpose-loader è¿™æ ·ä½¿ç”¨ï¼Œéœ€è¦æ‰‹åŠ¨ import jquery from 'jquery'ï¼›å½“ require è§£æžåˆ°è¿™ä¸ª import æ—¶ï¼Œå°±ä¼šèµ° expose-loaderä½†æ˜¯å¥½å¤„æ˜¯ï¼šåªä¼šåœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­æ‰“åŒ… { test: require.resolve('jquery'), use: { loader: 'expose-loader', options: { exposes: { globalName: '$', override: true } } } } babel-loader babeléžå¸¸æ…¢ï¼Œä¼˜åŒ–ä¸»è¦é€šè¿‡ä»¥ä¸‹ä¸¤ç‚¹ï¼š exclude æˆ–è€… include ç²¾ç¡®è§£æž cacheDirectory: true å¼€å¯ç¼“å­˜ { test: /.js$/, use: { loader: 'babel-loader', options: { presets: ['@babel/preset-env'] } } } cache-loader { test: /\\.js$/, use: [ 'cache-loader', 'babel-loader' ], include: path.resolve('src') } css-loader css-loader è§£é‡Š @import å’Œ url() Plugins CleanWebpackPlugin å¼€å‘æ—¶ dist ç›®å½•ä¸æ–­äº§å‡ºï¼Œæ–‡ä»¶å¾ˆå¤šå¾ˆä¹± const CleanWebpackPlugin = require('clean-webpack-plugin') new CleanWebpackPlugin(['dist']) ä¸å¸¦å‚æ•°çš„è¯ï¼Œä¼šæŠŠ output path ä½œä¸ºç›®æ ‡ç›®å½• å…¨å±€æ³¨å…¥æ–¹æ¡ˆä¸€ï¼šProvidePlugin ç¼ºç‚¹ï¼šæ¯”å¦‚ $: jqueryï¼Œä½¿ç”¨åˆ° $ çš„æ¨¡å—éƒ½ä¼šæ‰“åŒ…jqueryï¼Œé€ æˆé‡å¤æ‰“åŒ… é…ç½® noParse ä¹Ÿæ²¡ç”¨ const webpack = require('webpack') new webpack.ProvidePlugin({ $: 'jquery' }) extract-text-webpack-plugin const ExtractTextWebpackPlugin = require('extract-text-webpack-plugin') { test: /\\.css$/, use: ExtractTextWebpackPlugin.extract({ fallback: 'style-loader', use: 'css-loader' }) } plugins: [ new ExtractTextPlugin('style.css'), ] å¤šä¸ª css æ¨¡å— å¦‚ä½•å¤„ç†ï¼Ÿ const lessExtractPlugin = new ExtractTextWebpackPlugin('css/less.css') const cssExtractPlugin = new ExtractTextWebpackPlugin('css/css.css') const sassExtractPlugin = new ExtractTextWebpackPlugin('css/sass.css') // åŠ è½½å™¨ä»¥æ­¤ç±»æŽ¨ { test: /\\.css$/, use: cssExtractPlugin.extract({ fallback: 'style-loader', use: 'css-loader' }) } plugins: [ lessExtractPlugin, cssExtractPlugin, sassExtractPlugin, ] CopyWebpackPlugin const CopyWebpackPlugin = require('copy-webpack-plugin') new CopyWebpackPlugin({ from: path.join(__dirname, 'public'), to: path.join(__dirname, 'dist') }) AggressiveSplittingPlugin new webpack.optimize.AggressiveSplittingPlugin({ minSize: 30000, maxSize: 50000, chunkOverhead: 0, }) Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-11-09 19:41:18 "},"interview/webpack/4/1.html":{"url":"interview/webpack/4/1.html","title":"webpackåŠ¨æ€å¯¼å…¥ import æ˜¯å¦‚ä½•å®žçŽ°çš„","keywords":"","body":" è§£ç­” åŠ¨æ€å¯¼å…¥ import ä½¿ç”¨ // index.js document.getElementById('app').addEventListener('click', () => { import('./console.js').then(_console => { _console.log('clicked') }) }) //console.js function log (msg) { console.log(`system log: ${msg}`) } export { log } webpack æ‰“åŒ…ä¹‹åŽçš„æ ·å­ // main.js { './index.js': function (module, __webpack_exports__, __webpack_require__) { document.getElementById('app').addEventListener('click', () => { __webpack_require__.e(0).then( __webpack_require__.bind(null, './console.js') ).then(_console_ => { _console_.log('clicked') }) }) } } // 0.js window.webpackJsonp = window.webpackJsonp || [] window.webpackJsonp.push([ [0], { './console.js': function (module, __webpack_exports__, __webpack_require__) { Object.defineProperty(__webpack_exports__, 'log', { enumerable: true, get: function () { return log } }) function log (msg) { console.log(msg) } } } ]) webpack_require çš„å®žçŽ° (function (modules) { var installedModules = {}; function __webpack_require__ (moduleId) { if (installedModules[moduleId]) { return installedModules[moduleId] } var module = installedModules[moduleId] = { i: moduleId, l: false, exports: {} } modules[moduleId].call(module, module, module.exports, __webpack_require__) module.l = true return module.exports } })({ './index.js': function (){} }) webpack_require.eçš„å®žçŽ° var installedChunks = {} __webpack_require__.e = function requireEnsuer (chunkId) { var promises = [] var installedChunkData = installedChunks[chunkId] if (installedChunkData !== 0) { if (installedChunkData) { promises.push(installedChunkData[2]) } else { var promise = new Promise((resolve, reject) => { installedChunkData = installedChunks[chunkId] = [resolve, reject] }) promises.push((installedChunkdata[2] = promise)) var script = document.createElement('script') script.src = `${chunkId}.js` document.head.appendChild(script) } } return Promise.all(promises) } window.webpackJsonp æ˜¯ä»€ä¹ˆï¼Ÿ window.webpackJsonp æ˜¯ä¸ªæ•°ç»„ï¼Œä½†æ˜¯ä¼ ç»Ÿ jsonp åº”è¯¥æ˜¯è°ƒç”¨å›žè°ƒå‡½æ•°ï¼Œå¯æ˜¯æ‰“åŒ…ä¹‹åŽä»£ç ä¸ºä»€ä¹ˆæ˜¯ï¼šwindow.webpackJsonp.pushï¼Œå¦‚ä½•è§¦å‘å›žè°ƒå‘¢ï¼Ÿ var jsonpArray = window.webpackJsonp = window.webpackJsonp || [] var parentJsonpFunction = jsonpArray.push.bind(jsonArray) jsonpArray.push = webpackJsonpCallback for (let jsonp of jsonpArray) { webpackJsonpCallback(jsonp) } å¯ä»¥çœ‹å‡º window.webpackJsonp.pushï¼Œå¦‚æžœåœ¨main.jså·²åŠ è½½çš„æƒ…å†µä¸‹ï¼Œå…¶å®žå·²ç»æ˜¯ webpackJsonpCallback å‡½æ•°äº† webpackJsonpCallback çš„å®žçŽ° function webpackJsonpCallback (data) { const chunkIds = data[0] const moreModules = data[1] vat resolves = [] for (let chunkId of chunkIds) { resolves.push(installedChunks[chunkId][0]) installedChunks[chunkId] = 0 } for (let moduleName in moreModules) { modules[moduleName] = moreModules[moduleName] } if (parentJsonpFunction) parentJsonpFunction(data) while (resolves.length) { resolves.shift()() } } Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-11-12 16:06:53 "},"interview/webpack/5/1.html":{"url":"interview/webpack/5/1.html","title":"å¼€å‘ä¸€ä¸ªloaderï¼ŒæŠŠä»£ç ä¸­çš„ç®­å¤´å‡½æ•°ç¼–è¯‘ä¸ºæ™®é€šå‡½æ•°","keywords":"","body":" è§£ç­” const transformer = require(\"@babel/core\"); const t = require('@babel/types') module.exports = function(content, map, meta) { const ArrowFunctionToFunctionPlugin = { visitor: { ArrowFunctionExpression(path) { const ruturnStatement = t.returnStatement(path.node.body) const blockStatement = t.blockStatement([ruturnStatement]) const funcExpr = t.functionExpression(null, path.node.params, blockStatement) path.replaceWith(funcExpr) } } } const result = transformer.transform(content, { plugins: [ArrowFunctionToFunctionPlugin] }) return result.code } loaderçš„é…ç½® resolveLoader: { modules: [path.resolve(__dirname, 'loaders')], extensions: ['.js'], mainFields: ['loader'] } Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-11-13 15:58:45 "},"interview/webpack/6/1.html":{"url":"interview/webpack/6/1.html","title":"tapable çš„ä½¿ç”¨å’ŒåŽŸç†","keywords":"","body":" è§£ç­” SyncHook const { SyncHook } = require('tapable') const queue = new SyncHook(['n', 'a', 's']) queue.tap('1', function (name, age, sex) { console.log(name, age, sex) }) queue.tap('2', function (name, age) { console.log(name, age) }) queue.tap('3', function (name, age) { console.log(name, age) }) queue.call('1', 'xiur', 29, 'man') è‡ªå®šä¹‰å®žçŽ°: class SyncHook { constructor () { this._plugins = {} } tap (name, callback) { (this._plugins[name] || (this._plugins[name] = [])).push(callback) } call (...args) { for (let pluginName in this._plugins) { let plugins = this._plugins[pluginName] for (let plugin of plugins) { plugin.apply(this, args) } } } } module.exports = SyncHook SyncBailHook const { SyncBailHook } = require('tapable') const queue = new SyncBailHook(['n', 'a', 's']) queue.tap('1', function (name, age, sex) { console.log(name, age, sex) return 'Wrong' }) queue.tap('2', function (name, age) { console.log(name, age) }) queue.tap('3', function (name, age) { console.log(name, age) }) queue.call('1', 'xiur', 29, 'man') è‡ªå®šä¹‰å®žçŽ°ï¼š class SyncBailHook { constructor () { this._plugins = {} } tap (name, callback) { (this._plugins[name] || (this._plugins[name] = [])).push(callback) } call (...args) { for (let pluginName in this._plugins) { let plugins = this._plugins[pluginName] for (let plugin of plugins) { let result = plugin.apply(this, args) if (result) { return result } } } } } module.exports = SyncBailHook SyncWaterfallHook const { SyncWaterfallHook } = require('tapable') const queue = new SyncWaterfallHook(['n', 'a', 's']) queue.tap('1', function (name, age, sex) { console.log(name, age, sex) return name + '1' }) queue.tap('2', function (name, age) { console.log(name, age) return name + '2' }) queue.tap('3', function (name, age) { console.log(name, age) return name + '3' }) queue.call('xiur', 29, 'man') è‡ªå®šä¹‰å®žçŽ°ï¼š class SyncWaterfallHook { constructor () { this._plugins = {} } tap (name, callback) { (this._plugins[name] || (this._plugins[name] = [])).push(callback) } call (init, ...args) { let current = init for (let pluginName in this._plugins) { let plugins = this._plugins[pluginName] for (let plugin of plugins) { current = plugin.apply(this, [current, ...args]) } } } } module.exports = SyncWaterfallHook SyncLoopHook const { SyncLoopHook } = require('tapable') const queue = new SyncLoopHook(['n', 'a', 's']) let count = 3; queue.tap('1', function (name, age, sex) { console.log(count) if (count > 0) { count--; return count } else { return } }) queue.call('xiur', 29, 'man') è‡ªå®šä¹‰å®žçŽ°ï¼š class SyncLoopHook { constructor () { this._plugins = {} } tap (name, callback) { (this._plugins[name] || (this._plugins[name] = [])).push(callback) } call (...args) { for (let pluginName in this._plugins) { let plugins = this._plugins[pluginName] for (let plugin of plugins) { let result do { result = plugin.apply(this, args) } while (result !== undefined) } } } } module.exports = SyncLoopHook AsyncParalleHook å¼‚æ­¥å¹¶è¡ŒåŠ è½½ // const { AsyncParallelHook } = require('tapable') const AsyncParallelHook = require('./AsyncParallelHook') const hook = new AsyncParallelHook(['name']); console.time('cost'); hook.tapAsync('a', (name, cb) => { setTimeout(() => { console.log(`hello ${name}`); cb(); }, 2000) }) hook.tapPromise('a', name => { return new Promise((resolve) => { setTimeout(() => { console.log(`hello ${name}, again`); resolve(); }, 4000) }) }) hook.callAsync('a', () => { console.log('done'); console.timeEnd('cost'); }); è‡ªå®šä¹‰å®žçŽ°ï¼š class AsyncParallelHook { constructor () { this._plugins = {}; } tapAsync (name, callback) { (this._plugins[name] || (this._plugins[name] = [])).push(function (...args) { const cb = args.pop(); callback.call(this, ...args, () => { ++this.i; if (this.i >= this._plugins[name].length) { return cb() } }); }) } tapPromise (name, callback) { (this._plugins[name] || (this._plugins[name] = [])).push(function (...args) { callback.apply(this, args).then(() => { const cb = args.pop(); ++this.i; if (this.i >= this._plugins[name].length) { return cb() } }) }) } callAsync (...args) { this.i = 0; for (let pluginName in this._plugins) { let plugins = this._plugins[pluginName] for (let plugin of plugins) { plugin.apply(this, args) } } } } module.exports = AsyncParallelHook AsyncSeriesHook å¼‚æ­¥ä¸²è¡ŒåŠ è½½ const { AsyncSeriesHook } = require('tapable'); const hook = new AsyncSeriesHook(['name']); console.time('cost'); hook.tapAsync('a', (name, cb) => { setTimeout(() => { console.log(`hello ${name}`); cb(); }, 2000); }); hook.tapPromise('a', (name) => { return new Promise((resolve) => { setTimeout(() => { console.log(`hello ${name}, again`); resolve(); }, 4000); }); }); hook.callAsync('a', () => { console.log('done'); console.timeEnd('cost'); }); è‡ªå®šä¹‰å®žçŽ°ï¼š class AsyncSeriesHook { constructor () { this._plugins = {} this.next = this._next.bind(this) } tapAsync (name, callback) { (this._plugins[name] || (this._plugins[name] = [])).push(function (...args) { const cb = args.pop(); callback(...args, () => this.next(name, cb, [...args, cb])); }) } tapPromise (name, callback) { (this._plugins[name] || (this._plugins[name] = [])).push(function (...args) { const cb = args.pop(); callback(...args).then(() => this.next(name, cb, [...args, cb])) }) } _next (name, cb, args) { ++this.i; if (this.i >= this._plugins[name].length) { return cb(); } this._plugins[name][this.i].apply(this, args) } callAsync (...args) { this.i = 0 for (let pluginName in this._plugins) { let plugins = this._plugins[pluginName]; if (plugins) { plugins[0].apply(this, args) } } } } module.exports = AsyncSeriesHook AsyncSeriesBailHook å¼‚æ­¥ä¸²è¡Œç†”æ–­åŠ è½½ const { AsyncSeriesHook } = require('tapable'); const hook = new AsyncSeriesHook(['name']); console.time('cost'); hook.tapAsync('a', (name, cb) => { setTimeout(() => { console.log(`hello ${name}`); cb('yes'); }, 2000); }); hook.tapPromise('a', (name) => { return new Promise((resolve) => { setTimeout(() => { console.log(`hello ${name}, again`); resolve('yes'); }, 4000); }); }); hook.callAsync('a', () => { console.log('done'); console.timeEnd('cost'); }); class AsyncSeriesBailHook { constructor () { this._plugins = {} this.next = this._next.bind(this) } tapAsync (name, callback) { (this._plugins[name] || (this._plugins[name] = [])).push(function (...args) { const cb = args.pop(); callback(...args, ret => this.next(name, cb, [...args, cb], ret)); }) } tapPromise (name, callback) { (this._plugins[name] || (this._plugins[name] = [])).push(function (...args) { const cb = args.pop(); callback(...args).then(ret => this.next(name, cb, [...args, cb], ret)) }) } _next (name, cb, args, ret) { ++this.i; if (this.i >= this._plugins[name].length || ret !== undefined) { return cb(); } this._plugins[name][this.i].apply(this, args) } callAsync (...args) { this.i = 0 for (let pluginName in this._plugins) { let plugins = this._plugins[pluginName]; if (plugins) { plugins[0].apply(this, args) } } } } module.exports = AsyncSeriesBailHook Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-11-16 16:46:27 "}}