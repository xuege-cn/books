{"./":{"url":"./","title":"Introduction","keywords":"","body":"Introduction Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-07-03 16:08:07 "},"knowledge/":{"url":"knowledge/","title":"çŸ¥è¯†æ˜Ÿçƒ","keywords":"","body":"çŸ¥è¯†æ˜Ÿçƒ ðŸŒ è¿™é‡Œè®°å½•äº†å„ç§çŸ¥è¯†åˆ†ç±» Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-09-27 10:37:32 "},"interview/vue/":{"url":"interview/vue/","title":"vue","keywords":"","body":"è¿™é‡Œæ˜¯vueä¸“é¢˜ Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-07-03 16:11:09 "},"interview/vue/1/1.html":{"url":"interview/vue/1/1.html","title":"çˆ¶ç»„ä»¶ç›‘å¬å­ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ","keywords":"","body":" è§£æ³•1: @hook @hook:æ­é…ä»»æ„é’©å­å‡½æ•°ï¼Œä¼šåœ¨å­ç»„ä»¶è§¦å‘ç›¸åº”ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°æ—¶å›žè°ƒçˆ¶ç»„ä»¶è¿™ä¸ªå‡½æ•° è§£æ³•2: $emit è¿™ç§æ–¹å¼æ¯”è¾ƒè ¢ï¼Œè€Œä¸”æ˜¯éœ€è¦åŠ³åŠ¨åŠ›å †ç§¯çš„ mounted () { this.$emit('mounted') } Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-07-03 16:36:45 "},"interview/vue/2/1.html":{"url":"interview/vue/2/1.html","title":"$setè§£å†³æ–°å¢žå±žæ€§ä¸èƒ½ç›¸åº”çš„é—®é¢˜","keywords":"","body":" è§£ç­”ï¼š æ˜¯å› ä¸ºVueåœ¨å®žä¾‹åŒ–çš„è¿‡ç¨‹ä¸­å°±éœ€è¦å¯¹dataä¸­çš„æ•°æ®ä½¿ç”¨definePropertyæ–¹æ³•æ¥å®šä¹‰å­˜å–å™¨å®žçŽ°çš„å“åº”å¼ã€‚è€Œç›´æŽ¥æ–°å¢žå±žæ€§å› ä¸ºä»æ˜¯å€¼å±žæ€§ï¼Œæ‰€ä»¥æ˜¯ä¸èƒ½å®žçŽ°å“åº”å¼çš„ æºç å®žçŽ° const isValidArrayIndex = index => { return index > 0 && Math.floor(index) === index && isFinite(index) } exprt function set (target, key, val) { if (Array.isArray(target) && isValidArrayIndex(key)) { target.length = Math.max(target.length, key) target.splice(key, 1, val) return val } if (key in target && !(key in target.prototype)) { target[key] = val return val } const __ob__ = target.__ob__ if (!__ob__) { target[key] = val return val } else { defineReactive(__ob__.value, key, val) __ob__.dep.notify() return val } } setåˆ†ä¸ºå››æ­¥éª¤ï¼š åˆ¤æ–­æ˜¯å¦ä¸ºæ•°ç»„ï¼Œä»¥åŠç´¢å¼•æ˜¯å¦åˆæ³• Array.isArrayåˆ¤æ–­targetæ˜¯å¦ä¸ºæ•°ç»„ ç´¢å¼•æ˜¯å¦åˆæ³•ï¼šindex > 0 && Math.floor(index) === index && isFinite(index) æ•°ç»„å¯èƒ½ä¸å¤Ÿé•¿ï¼Œå…ˆæŠŠæ•°ç»„æ‰©å……ä¸‹ï¼štarget.length = Math.max(target.length, key) é€šè¿‡spliceå¾€æ•°ç»„ä¸­æ·»åŠ ï¼štarget.splice(key, 1, val) åˆ¤æ–­targetå¯¹è±¡ä¸‹æ˜¯å¦å·²ç»è¯¥å±žæ€§key å­˜åœ¨çš„è¯å°±æ˜¯ä¿®æ”¹æ“ä½œï¼Œç›´æŽ¥target[key] = valï¼Œé€šè¿‡setterå­˜å–å™¨è§¦å‘notify targetæ˜¯å¦å·²è¢«å“åº”å¼ å¦ï¼šä¸ç®¡å“åº”å¼ï¼Œtarget[key] = valå®Œäº‹ å·²è®¾ç½®å“åº”å¼ï¼ŒdefineReactive(ob.value, key, val), ob.dep.notify()è§¦å‘æ›´æ–° definePropertyçš„ç¼ºç‚¹ ä»Žè¿™ä¸ªé—®é¢˜å¯ä»¥çœ‹å‡ºï¼šdefinePropertyå®žçŽ°å“åº”å¼ï¼Œéœ€è¦åœ¨vueå®žä¾‹åŒ–æ—¶å¯¹æ‰€æœ‰å±žæ€§è¿›è¡Œé‡å®šä¹‰ï¼Œä¸ç„¶çš„è¯å°±ä¸èƒ½å®žçŽ°å“åº”å¼æœ‰ç‚¹ç±»ä¼¼äº‹ä»¶ç»‘å®šæ—¶ï¼Œå¯¹å•ä¸ªèŠ‚ç‚¹ Proxyçš„ä½¿ç”¨ let obj = { a: 1, b: 2 } let obj1 = new Proxy(obj, { get (obj, prop) { console.log(`æ­£åœ¨èŽ·å–å±žæ€§ï¼š${prop}ï¼Œå€¼ä¸ºï¼š${obj[prop]}`) return obj[prop] } }) obj1.a obj1.b Proxyç±»ä¼¼äº‹ä»¶å§”æ‰˜ï¼ŒæŠŠå±žæ€§è®¿é—®å§”æ‰˜åˆ°å¦ä¸€ä¸ªå¯¹è±¡ä¸Šï¼Œå¯æ˜¯ä¸å…·ä½“å…³å¿ƒæ˜¯ä»€ä¹ˆå±žæ€§ï¼Œæ‰€ä»¥åœ¨Vueå®žä¾‹åŒ–é˜¶æ®µå‡å°‘äº†å¯¹dataä¸‹æ‰€æœ‰å±žæ€§è¿›è¡ŒdefinePropertyå®šä¹‰å­˜å–å™¨ Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-07-06 19:21:01 "},"interview/vue/3/1.html":{"url":"interview/vue/3/1.html","title":"è‡ªå®šä¹‰æŒ‡ä»¤å®žçŽ°å›¾ç‰‡æ‡’åŠ è½½","keywords":"","body":" å›¾ç‰‡æ‡’åŠ è½½çš„ä¸‰ç§å®žçŽ°æ–¹å¼ scrolläº‹ä»¶ + getBoundingClientRect const imgs = document.getElementsByTagName('img') const body = document.body function imgLoad () { for (let img of imgs) { const clientRect = img.getBoundingClientRect() if (clientRect.bottom { timer = null func.apply(this, args) }, wait) } } } document.addEventListener('scroll', throttle(imgLoad, 0)) imgLoad() InsectionObserver const imgs = document.getElementsByTagName('img') const intersectionObserver = new IntersectionObserver(function(entries) { for (let entry of entries) { if (entry.intersectionRatio > 0) { const target = entry.target target.style.height = 'auto' target.src = target.getAttribute('data-src') intersectionObserver.unobserve(target) } } }) for (let img of imgs) { intersectionObserver.observe(img) } æµè§ˆå™¨åŽŸç”Ÿæ”¯æŒloading=\"lazy\" Vueè‡ªå®šä¹‰æŒ‡ä»¤ + å›¾ç‰‡æ‡’åŠ è½½ æ¨¡ç‰ˆï¼š const intersectionObserver = new IntersectionObserver(function(entries) { for (let entry of entries) { if (entry.intersectionRatio > 0) { const target = entry.target target.style.height = 'auto' target.src = target.getAttribute('data-src') intersectionObserver.unobserve(target) } } }) directives: { lazy: { inserted: function (el) { intersectionObserver.observe(el) } } } directiveçš„é’©å­å‡½æ•° bindï¼šæŒ‡ä»¤ç¬¬ä¸€æ¬¡ç»‘å®šåˆ°å…ƒç´ æ—¶è°ƒç”¨ insertedï¼šå…ƒç´ æ’å…¥çˆ¶èŠ‚ç‚¹æ—¶è°ƒç”¨ updateï¼šæ‰€åœ¨ç»„ä»¶VNodeæ›´æ–°æ—¶è°ƒç”¨ Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-09-03 15:50:13 "},"interview/vue/4/1.html":{"url":"interview/vue/4/1.html","title":"keep-alive","keywords":"","body":"keep-aliveå¦‚ä½•å®žçŽ°ç»„ä»¶ç¼“å­˜ keep-alive ä»‹ç» keep-alive æ˜¯ vue çš„ä¸€ä¸ªå†…ç½®ç»„ä»¶ï¼Œä¸»è¦æŽ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œincludeï¼Œexclude å’Œ maxï¼Œinclude å’Œ exclude å¯ä»¥æŽ¥æ”¶ Stringï¼ŒRegExpï¼Œ Array ä¸‰ç§ç±»åž‹æ•°æ®ï¼Œç”¨ä»¥åŒ¹é…ç»„ä»¶ Nameï¼Œmax è¡¨ç¤ºæœ€å¤šä¿å­˜å®žä¾‹ä¸ªæ•°ï¼Œè‹¥è¶…è¿‡è¿™ä¸ªæ•°å­—ï¼Œå·²ç¼“å­˜ç»„ä»¶ä¸­æœ€ä¹…æ²¡æœ‰è¢«è®¿é—®çš„å®žä¾‹ä¼šè¢«é”€æ¯æŽ‰ keep-aliveçš„ä½¿ç”¨ Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-10-15 14:29:40 "},"interview/vue/5/1.html":{"url":"interview/vue/5/1.html","title":"next-tick","keywords":"","body":"next-tick next-tickçš„ä½œç”¨ next-tick å°±æ˜¯ä¸¢ä¸€ä¸ªä»»åŠ¡è¿›åŽ»ï¼Œåœ¨ç©ºé—²çš„æ—¶å€™åŽ»æ‰§è¡Œ next-tickçš„è‡ªå®šä¹‰å®žçŽ° let timerFunc; let callbacks = []; function nextTick (cb, ctx) { const callback = () => { cb.call(ctx); } callbacks.push(callback); timerFunc(); } if (typeof Promise !== 'undefined') { const p = Promise.resolve(); timerFunc = () => { p.then(flushCallbacks); } } else if (typeof MutationObserver !== 'undefined') { let count = 1; const mo = new MutationObserver(flushCallbacks); const textNode = document.createTextNode(); mo.observe(textNode, { characterData: true }); timerFunc = () => { count = 1 - count; textNode.data = String(count); } } else if (typeof setImmediate === 'function') { timerFunc = setImmediate(flushCallbacks); } else if (typeof setTimeout === 'function') { timerFunc = setTimeout(flushCallbacks, 0); } function flushCallbacks () { let cbs = callbacks.slice(0); for (let cb of cbs) { cb(); } } Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-10-15 15:33:52 "},"interview/vue/6/1.html":{"url":"interview/vue/6/1.html","title":"vueå¦‚ä½•åšç¼–è¯‘æ—¶ä¼˜åŒ–AOTï¼Ÿ","keywords":"","body":" JIT å³æ—¶ç¼–è¯‘ï¼šjust-in-time compile React çš„æ¨¡ç‰ˆä¸­å…è®¸å†™ js ä»£ç ï¼Œç„¶è€Œ vue çš„æ¨¡ç‰ˆä¸­ä¸å…è®¸å†™ js ä»£ç  React æ˜¯å³æ—¶ç¼–è¯‘ï¼Œä¼šåœ¨æ‰§è¡Œæ—¶æŠŠ jsx ç¼–è¯‘ä¸º js ä»£ç  Vue æ˜¯å³æ—¶ç¼–è¯‘å…¼è¿è¡Œå‰ç¼–è¯‘ï¼Œå°±çœ‹ $options.render æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨ä¸ºè¿è¡Œå‰ç¼–è¯‘ï¼Œåä¹‹å³æ—¶ç¼–è¯‘ AOT è¿è¡Œå‰ç¼–è¯‘ï¼šAhead-of-time compile Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-10-22 16:57:59 "},"interview/vue/7/1.html":{"url":"interview/vue/7/1.html","title":"å¦‚ä½•ç»™Vueå®šä¹‰å…¨å±€æ–¹æ³•","keywords":"","body":" è§£ç­” Vue.prototype Vue.prototype.call = () => console.log('call') mixin æ–¹å¼ const mixin = { methods: { call () { console.log('call') } } } Vue.mixin(mixin) Plugin æ–¹å¼ const plugin = { install (Vue) { Vue.prototype.$call = () => { console.log('call') } } } Vue.use(plugin) Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-11-03 18:30:17 "},"interview/vue/8/1.html":{"url":"interview/vue/8/1.html","title":"å“åº”å¼ä¸Žcteatedï¼Œ$mountï¼Œmounted","keywords":"","body":" ä»¥ä¸Šä»£ç æ¨¡ç‰ˆä¸­æ¸²æŸ“çš„æ˜¯ä»€ä¹ˆå€¼ï¼Ÿ è§£ç­” æ¨¡ç‰ˆä¸­æ˜¾ç¤ºä¸º1 vueå®žä¾‹åŒ–çš„é¡ºåºæ˜¯ï¼š initStateï¼šobserve(options.data) callHook(vm, 'created') vm.$mount callHook(vm, 'mounted') åŽŸå› ï¼š æœ€å…ˆæ‰§è¡Œobserveï¼Œæ‰€ä»¥åœ¨ created å’Œ mounted æ·»åŠ çš„å±žæ€§ï¼Œéƒ½ä¸æ˜¯å“åº”å¼å±žæ€§ created åœ¨ $mount ä¹‹å‰æ‰§è¡Œï¼Œ$mount æŒ‚è½½æ—¶å€¼å·²ç»æ˜¯1ï¼Œæ‰€ä»¥æ¸²æŸ“æ—¶ä¸º1 mounted æ—¶æŠŠ b æ”¹ä¸ºäº†2ï¼Œå¯æ˜¯å±žæ€§æ²¡æœ‰è¢« observeï¼Œä¸”å¹¶æ²¡æœ‰é‡æ–°æ¸²æŸ“ï¼Œæ‰€ä»¥è¿˜æ˜¯1 Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-11-04 16:12:47 "},"interview/vue/9/1.html":{"url":"interview/vue/9/1.html","title":"vue-router ä½¿ç”¨","keywords":"","body":"vue-router ä½¿ç”¨ åŠ¨æ€è·¯ç”±åŒ¹é… /user/:id åŒ¹é… /user/foo, /user/bar, this.$router.params.id èŽ·å–å‚æ•° å“åº”è·¯ç”±å‚æ•°å˜åŒ– ä»Ž /user/foo åˆ° /user/barï¼ŒUser ç»„ä»¶ä¼šè¢«å¤ç”¨ï¼Œå› ä¸ºæ˜¯åŒä¸€ç»„ä»¶ï¼Œå¤ç”¨æ¯”é”€æ¯é‡å»ºæ›´é«˜æ•ˆï¼Œä½†æ˜¯ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸé’©å­ä¸ä¼šå†è¢«è°ƒç”¨å¦‚æžœæƒ³å¯¹è·¯ç”±å‚æ•°å˜åŒ–ä½œå‡ºå“åº”ï¼Œå¦‚ä¸‹ðŸ‘‡ï¼š æ–¹æ¡ˆä¸€ï¼š watch: { $route (to, from) { // ç›‘å¬è·¯ç”±å‚æ•°å˜åŒ– } } æ–¹æ¡ˆäºŒï¼šå¯¼èˆªå®ˆå« beforeRouteUpdate (to, from, next) { next() } åŒ¹é…ä»»æ„è·¯ç”± { path: '*', path: 'user-*' } åŒ¹é…ä¼˜å…ˆçº§ è°åœ¨å‰é¢è°çš„ä¼˜å…ˆçº§é«˜ ç¼–ç¨‹å¼å¯¼èˆª - this.$router - push - replace - go å‘½åè·¯ç”± User router.push({ name: 'user', params: { userId: 123 }}) è·¯ç”±ç»„ä»¶ä¼ å‚è§£è€¦ åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ $router.params.id æ˜¯å¾ˆä¸ä¼˜é›…çš„ï¼Œä½¿å¾—ç»„ä»¶å’Œç‰¹å®šè·¯ç”±äº§ç”Ÿäº†è€¦åˆ { path: '/user', component: User, props: true } Userç»„ä»¶ User {{id}} é€šè¿‡è®¾ç½® props å‚æ•°ï¼ŒæŠŠè·¯ç”±å‚æ•°æ˜ å°„åˆ°ç»„ä»¶çš„ props ä¸­ HTML5 historyæ¨¡å¼ hash æ¨¡å¼ï¼š ä¸‘ï¼Œå…¼å®¹æ€§å¥½ï¼Œæ˜¯ vue çš„é»˜è®¤æ¨¡å¼history æ¨¡å¼ï¼šå…¼å®¹æ€§å·®ï¼ŒåŽç«¯éœ€è¦é…ç½®ï¼šhttp://oursite.com/user/id ä¼šæ‰¾ä¸åˆ°é¡µé¢ nginx: location / { try_files $uri $uri/ /index.html; } å¯¼èˆªå®ˆå« beforeEach beforeResolve afterEach è·¯ç”±é…ç½®ç‹¬äº« { path: '/user', beforeEnter (to, from, next) {} } ç»„ä»¶å†…çš„å®ˆå« beforeRouteEnter beforeRouteUpdate beforeRouteLeave è·¯ç”±å…ƒä¿¡æ¯ { path: '/user', meta: { requiresAuth: true } } ä»Ž $route.matched[0].meta è·¯ç”±è¿‡æ¸¡åŠ¨æ•ˆ slide fade slide-right slide-left è·¯ç”±ä¸Žæ•°æ®èŽ·å– è·¯ç”±å®ˆå« beforeRouterUpdate watch: { '$route': 'fetchData' } æ»šåŠ¨è¡Œä¸º new VueRouter({ scrollBehavior (to, from, savedPosition){ return { x: 0, y: 0 } return savedPosition } }) è·¯ç”±æ‡’åŠ è½½ å°†å¤šä¸ªåŒåç§°çš„å¼‚æ­¥å—ç»„åˆåˆ°ä¸€èµ· const Bar = () => import(/* webpackChunkName: \"bar\" */ './Bar.vue') const Baz = () => import(/* webpackChunkName: \"bar\" */ './Baz.vue') Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-12-14 19:20:20 "},"interview/vue/10/1.html":{"url":"interview/vue/10/1.html","title":"vue-routerå®Œå…¨è§£æž","keywords":"","body":" æ€è€ƒä¸‹ VueRouter å®žçŽ°æ ¹æœ¬ popstate æˆ– hashchange ç›‘å¬è·¯ç”±å˜åŒ– èŽ·å–åˆ°æ–°çš„è·¯ç”±ï¼Œä»Žè·¯ç”±é…ç½®ä¸­èŽ·å–å¯¹åº”ç»„ä»¶ è·¯ç”±å¯èƒ½æœ‰å¥½å‡ å±‚ï¼Œæ‰€ä»¥éœ€è¦åŒ¹é…åˆ°å¤šä¸ªç»„ä»¶ matched èŽ·å–åˆ°æ–°çš„è·¯ç”±ï¼Œéœ€è¦åˆ·æ–° UIï¼Œä½¿ç”¨ Vue.util.defineReactive(this, '_route', this.router.history.current) é€šè¿‡æ”¹å˜ current ä¸­çš„ path å’Œ matched ä½¿ UI åˆ·æ–° Link ç»„ä»¶ä¸»è¦æ˜¯æ›¿æ¢ä¸º aï¼Œç„¶åŽåœ¨ç‚¹å‡»ä½¿ preventDefaultï¼Œç„¶åŽè°ƒç”¨ history.push(this.to) è·³è½¬æ–°è·¯ç”± è°ƒç”¨ history.push æ”¹å˜è·¯ç”±ï¼Œä¼šä½¿ hash ç­‰ç›‘å¬åˆ°å˜åŒ–ï¼Œè°ƒç”¨ transitionTo èŽ·å–æ–°çš„ current View ç»„ä»¶ä¸»è¦æ˜¯åŽ»èŽ·å– history.current, ç„¶åŽé€šè¿‡ createElement åˆ›å»ºè·¯ç”±å¯¹åº”çš„ UI å¤šå±‚è·¯ç”±çš„æƒ…å†µï¼Œéœ€è¦ç»´æŠ¤ depth è®°å½•å±‚çº§ï¼Œæ¯å½“å®žä¾‹åŒ– View æ—¶ï¼ŒæŠŠå½“å‰ç»„ä»¶åœ¨ $vnode.data.routerView æ ‡è®°ä¸º trueï¼ŒéåŽ†çˆ¶ç»„ä»¶ï¼Œæ¯å½“é‡åˆ° routerView: trueï¼Œdepth+1, ä»Žè€Œå®žçŽ°å¤šå±‚çº§è·¯ç”± vue-routerå¦‚ä½•ä½¿ç”¨ routeså£°æ˜Ž æ¯ä¸ªè·¯ç”±ä¸»è¦æ˜¯å››ä¸ªå±žæ€§ï¼šnameï¼Œpathï¼Œcomponentï¼Œchildren const routes = [ { name: 'Home', path: '/home', component: Home, children: [ { name: 'Tel', path: 'tel', component: Tel, }, { name: 'About', path: 'about', component: About, }, ], }, { name: 'Foo', path: '/foo', component: Foo, }, { name: 'Bar', path: '/bar', component: Bar, } ] é€šè¿‡ routes å®žä¾‹åŒ– router import VueRouter from 'vue-router' const router = new VueRouter({ mode: 'hash | history', routes }) Vue ä½¿ç”¨ router Vue.use(VueRouter) new Vue({ router, render: h => h(App) }).$mount('#app') å®žçŽ°åˆ†æž ä»Ž VueRouter ä½¿ç”¨åˆ†æžå®žçŽ° Vue.use(VueRouter) new VueRouter({ mode: 'hash', routes }) VueRouter æ˜¯ä¸ªç±» VueRouter æœ‰ä¸ªé™æ€æ–¹æ³• install ä»Žç»„ä»¶å®žä¾‹å±žæ€§åˆ†æž - Root - _route - path: /home/tel - matched: [{ path: '/home', component:... }, { path: '/home/tel', component:... },] - _router - app - history - current: { path: '/home/tel', matched:[...] } - listeners: - router - matcher - addRoutes - match - beforeHooks - afterHooks - _routerRoot - Home - $vnode - data - routerView: true - _routerRoot _routerRoot æ˜¯æ ¹ç»„ä»¶ï¼Œå¯ä»¥å‘çŽ°æ¯ä¸ªç»„ä»¶ä¸Šéƒ½ç»´æŠ¤äº† _routerRoot _router æ˜¯ VueRouter å®žä¾‹ï¼Œåªæœ‰æ ¹ç»„ä»¶ç»´æŠ¤ _route ä¹Ÿåªæœ‰æ ¹ç»„ä»¶ç»´æŠ¤ï¼Œæ˜¯ä¸ªåŒ¹é…å™¨åŒ¹é…åˆ°çš„ç»“æžœ ä»€ä¹ˆæ—¶å€™æ¥æ··å…¥ _routerRoot å’Œ _router å‘¢ï¼Ÿä½¿ç”¨åŽŸåž‹ Vue.prototype è¿‡äºŽæš´åŠ›ï¼Œå¯ä»¥ä½¿ç”¨ Vue.mixin Vue.mixin æ··å…¥ _routerRoot å’Œ _router VueRouter.install = function (Vue) { Vue.mixin({ beforeCreate () { if (this.$options.router) { this._routerRoot = this this._router = this.$options.router this._router.init(this) Vue.util.defineReactive(this, '_router', this.router.history.current) } else { this._routerRoot = this.$parent && this.$parent._routerRoot } } }) } VueRouter å®žçŽ° import RouterLink from './components/link' import RouterView from './components/view' import HashHistory from './history/HashHistory' import BrowserHistory from './history/BrowserHistory' import createMatcher from './matcher/create-matcher' class VueRouter { constructor (options) { this.mode = options.mode; this.matcher = createMatcher(options.routes); switch (this.mode) { case 'hash': this.history = new HashHistory(this); break; case 'history': this.history = new BrowserHistory(this); break; } } init (app) { this.app = app; const history = this.history; history.transitionTo( history.getCurrentLocation(), history.setupListener.bind(history) ); } addRoutes (routes) { this.matcher.addRoutes(routes); } push (location) { this.history.push(location) } } VueRouter.install = function (Vue) { Vue.mixin({ beforeCreate () { if (this.$options.router) { this._routerRoot = this; this._router = this.$options.router this._router.init(this) Vue.util.defineReactive(this, '_route', this._router.history.current) } else { this._routerRoot = this.$parent && this.$parent._routerRoot } } }) Vue.component('router-link', RouterLink); Vue.component('router-view', RouterView); } export default VueRouter è·¯ç”±æ‹å¹³ function createMatcher (routes) { let { pathMap } = createPathMap(routes); function addRoutes (routes) { createPathMap(routes, pathMap); console.log('ã€åŒ¹é…å™¨ã€‘è·¯ç”±æ‹å¹³ï¼š', pathMap) } function match (path, _route) { let matched = [] let record = pathMap[path] if (record) { matched.push(record) while(record.parent) { matched.unshift(record.parent) record = record.parent } } _route.path = path _route.matched = matched return _route; } console.log('ã€åŒ¹é…å™¨ã€‘è·¯ç”±æ‹å¹³ï¼š', pathMap) return { addRoutes, match } } function createPathMap (routes, oldPathMap, parent) { let pathMap = oldPathMap || {}; for (let router of routes) { const children = router.children const path = parent ? `${parent.path}/${router.path}` : router.path pathMap[path] = { ...router, path, parent }; children && createPathMap(children, pathMap, router); } return { pathMap } } export default createMatcher history å®žçŽ° // Base.js class Base { constructor (router) { this.router = router this.current = {}; } transitionTo (path, handler) { this.current = this.router.matcher.match(path, this.current) handler && handler(); } } export default Base; // BrowserHistory.js import Base from './Base' class BrowserHistory extends Base { constructor (router) { super(router) } getCurrentLocation () { return window.location.pathname } setupListener () { window.addEventListener('popstate', () => { this.transitionTo( this.getCurrentLocation() ) }) } push (location) { history.pushState({}, '', location) } } export default BrowserHistory; // HashHistory.js import Base from './Base' function ensureSlash () { if (window.location.hash) { return; } window.location.hash = '/' } class HashHistory extends Base { constructor (router) { super(router) ensureSlash() } getCurrentLocation () { return window.location.hash.slice(1) } setupListener () { window.addEventListener('hashchange', () => { this.transitionTo( this.getCurrentLocation() ) }) } push (location) { window.location.hash = location; } } export default HashHistory; RouterLink RouterView ç»„ä»¶å®žçŽ° // RouterLink.js const Link = { props: { to: String, }, render (h) { return h( 'a', { attrs: { href: this.to }, on: { click: this.clickEvt } }, [ this.$slots.default ] ) }, methods: { clickEvt (e) { e.preventDefault(); this._routerRoot._router.push(this.to); } } } export default Link; // RouterView.js const View = { functional: true, render (createElement, context) { let depth = 0; let comp = context.parent const matched = comp._routerRoot._router.history.current.matched; let parent = comp.$parent while (parent) { const vnode = parent.$vnode if (vnode && vnode.data.routerView) { depth++ } parent = parent.$parent } if (Array.isArray(matched)) { const router = matched[depth] comp.$vnode.data.routerView = true if (router) { return createElement(router.component) } } } } export default View; è·¯ç”±å®ˆå« // æ·»åŠ å®ˆå« router.beforeHook((to, from, next) => { console.log('è·¯ç”±ï¼š', to, from) setTimeout(() => { console.log(1); next(); }, 1000) }) router.beforeHook((to, from, next) => { console.log('è·¯ç”±ï¼š', to, from) setTimeout(() => { console.log(2); next(); }, 1000) }) // åœ¨è·³è½¬ä¹‹å‰ï¼Œæ‰§è¡Œå®ˆå«ï¼Œæœ€åŽå†è·³è½¬ transitionTo (path, handler) { const updateRouter = () => { this.current = this.router.matcher.match(path, this.current || {}) handler && handler(); } const runHooks = () => { const from = this.current.path const beforeHooks = this.router.beforeHooks if (beforeHooks && beforeHooks.length) { beforeHooks.reduce((prev, current, idx) => { let next = current if (idx === (beforeHooks.length - 1)) { next = () => current(path, from, updateRouter) } return prev ? prev(path, from, next) : current; }) } } (this.current ? runHooks : updateRouter)() } Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-12-14 17:20:20 "}}