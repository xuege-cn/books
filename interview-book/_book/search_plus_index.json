{"./":{"url":"./","title":"Introduction","keywords":"","body":"Introduction Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-07-03 16:08:07 "},"knowledge/":{"url":"knowledge/","title":"çŸ¥è¯†æ˜Ÿçƒ","keywords":"","body":"çŸ¥è¯†æ˜Ÿçƒ ğŸŒ è¿™é‡Œè®°å½•äº†å„ç§çŸ¥è¯†åˆ†ç±» Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-09-27 10:37:32 "},"interview/react/":{"url":"interview/react/","title":"react","keywords":"","body":"React æ¯æ—¥ä¸€é¢˜ Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-10-09 19:16:37 "},"interview/react/1/1.html":{"url":"interview/react/1/1.html","title":"React Contextçš„ç†è§£","keywords":"","body":" è§£ç­” React Context ä¸»è¦æ˜¯è§£å†³è·¨å±‚çº§ç»„ä»¶æ•°æ®ä¼ é€’ï¼Œå¯ä»¥å½“ä½œæ˜¯ç‰¹å®šä¸€ä¸ªç»„ä»¶æ ‘å†…å…±äº«çš„store è¿‡æ—¶çš„Context class Grand extends PureComponent { static childContextTypes = { text: PropTypes.string } getChildContext () { return { text: 'halo! old context' } } } class Child extends React.Component { static contextTypes = { text: PropTypes.string } render () { return {this.context.text} } } æ–°Context const TextContext = React.createContext(); class Grand extends React.Component { render () { return } } class Child extends React.Component { static contextType = TextContext render () { return {this.context.text} } } å‡½æ•°ç»„ä»¶å¦‚ä½•ä½¿ç”¨ Context function Child () { return { value => {value} } } å®ç°è‡ªå®šä¹‰ä¸Šä¸‹æ–‡ function createContext () { function Provider (props) { Provider.value = props.value; return props.children } function Consumer (props) { return props.children(Provider.value); } return { Provider, Consumer } } class Child extends React.Component { static contextType = TextContent; constructor () { this.context = Child.contextType.Provider.value } } ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼šä¸åŒå±‚çº§çš„ç»„ä»¶éœ€è¦è®¿é—®åŒæ ·ä¸€äº›æ•°æ® ç¼ºç‚¹ï¼šç»„ä»¶çš„å¤ç”¨æ€§å˜å·® ç»„ä»¶å¤ç”¨æ˜¯ä¸€ç§æ›´å¥½çš„æ–¹å¼ Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-11-30 11:21:58 "},"interview/react/2/1.html":{"url":"interview/react/2/1.html","title":"React fiberæ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆç”¨","keywords":"","body":" ä¸ºä»€ä¹ˆéœ€è¦ React fiber react v16 ä¹‹å‰æ˜¯é€šè¿‡ æ ‘å½¢ç»“æ„ ä¿å­˜ virtual domï¼Œè¿™ç§ç»“æ„æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š æ›´æ–°ä»»åŠ¡æ˜¯ä¸å¯ä¸­æ­¢çš„ï¼šæ¯”å¦‚å½“å‰æ›´æ–°åˆ°äº†æŸä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœä»»åŠ¡åœæ­¢äº†ï¼Œé‚£ä¹ˆéœ€è¦é‡æ–°è¿›è¡Œæ›´æ–° ä»»åŠ¡æ‰§è¡Œæ—¶é•¿è¿‡é•¿å¯¼è‡´ä¸¢å¸§ï¼šç”±äºæ›´æ–°ä»»åŠ¡æ˜¯ä¸å¯ä¸­æ­¢çš„ï¼Œæ—¶é—´å°±å¾ˆéš¾æŒæ§ï¼Œå½“ä¸€ä¸ª dom tree èŠ‚ç‚¹å¾ˆå¤šæ—¶ï¼Œæ‰§è¡Œæ—¶é—´å°±ä¼šå¾ˆé•¿ï¼Œæ¯”å¦‚ä¸€å¸§çš„æ—¶é—´æ›´é•¿ã€‚å°±å¯èƒ½å¯¼è‡´ä¸¢å¸§ fiber æ˜¯ä»€ä¹ˆ å¯ä»¥ç†è§£ä¸º fiber æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œvirtual dom ä» æ ‘å½¢ç»“æ„ å˜æˆ fiber tree é“¾è¡¨ç»“æ„ å¦‚ä½•å®ç° fiber é“¾æ¥ç»“æ„ æ ‘å½¢ç»“æ„æ˜¯é€šè¿‡ children æ¥å…³è”å„ä¸ªèŠ‚ç‚¹ï¼Œé€šè¿‡æ·±åº¦ä¼˜å…ˆéå†çš„æ–¹å¼è¿›è¡Œ diffé“¾è¡¨ç»“æ„æ˜¯é€šè¿‡ childï¼Œsibling return æ¥å…³è”å„ä¸ªèŠ‚ç‚¹ï¼Œé€šè¿‡æ·±åº¦ä¼˜å…ˆéå†çš„æ–¹å¼ä»¥åŠ firstEffectï¼ŒnextEffectï¼ŒeffectTag çš„é…åˆè¿›è¡Œ diff æ›´æ–° React åŸç”Ÿ fiber è·å–æ¸²æŸ“çš„ fiber root document.getElementById('app')._reactRootContainer._internalRoot; fiber root ç»“æ„ FiberRootNode { - containerInfo: div#app - current: FiberNode - child: - child: - return: FiberRootNode - sibling: null - firstEffect: null - lastEffect: null - nextEffect: null - stateNode: ul.list - return: null - sibling: null - firstEffect: ul - lastEffect: ul - nextEffect: null - stateNode: div#app - hydrat: false } å¦‚ä½•å®ç°ä¸€ä¸ªç®€ç‰ˆ React fiber React fiberæ˜¯ä¸€ä¸ªé“¾è¡¨ç»“æ„ï¼Œæ‰€ä»¥éå†é“¾è¡¨ workLoop function workLoop () { while (nextUnitOfWork) { nextUnitOfWork = performUnitOfWork(nextUnitOfWork) } // æäº¤æ”¾åˆ°æœ€åä¸€èµ·æäº¤ï¼Œé¿å…éƒ¨åˆ†èŠ‚ç‚¹æ¸²æŸ“äº†ï¼Œéƒ¨åˆ†èŠ‚ç‚¹æœªæ¸²æŸ“ commitRoot() } performUnitOfWork ä¸¤ä¸ªä½œç”¨ï¼š å¼€å§‹å½“å‰ workInProgress çš„å·¥ä½œ è¿”å›é“¾è¡¨ä¸‹ä¸€ä¸ªèŠ‚ç‚¹: æœ‰å„¿å­è¿”å›å„¿å­ï¼Œæ²¡å„¿å­è¿”å›å”å”ï¼Œæ²¡å”å”å¾€ä¸Šèµ° å½“ä¸€ä¸ªèŠ‚ç‚¹æ²¡å„¿å­æ—¶ï¼Œæ‰§è¡Œ compeleteUnitOfWork function performUnitOfWork (workInProgress) { beginWork(workInProgress) if (workInProgress.child) { return workInProgress.child } while (workInProgress) { completeUnitOfWork(workInProgress) if (workInProgress.sibling) { return workInProgress.sibling } workInProgress = workInProgress.return } } beginWork ä¸¤ä¸ªä½œç”¨ï¼š åˆ›å»º stateNode ç»´æŠ¤ childï¼Œreturnï¼Œsiblingï¼ŒeffectTag function beginWork (workInProgress) { if (!workInProgress.stateNode) { workInProgress.stateNode = document.createElement(workInProgress.type) } let prevFiber workInProgress.props.children.forEach((child, index) => { if (typeof child === 'string') { const childEl = document.createElement(child) workInProgress.stateNode.appendChild(childEl) } else { child = { ...child, return: workInProgress, child: null, sibling: null, effectTag: 'PLACEMENT', firstEffect: null, lastEffect: null, nextEffect: null } if (index === 0) { workInProgress.child = child } else { prevFiber.sibling = child } prevFiber = child } }) } completeUnitOfWork ç»´æŠ¤firstEffectï¼ŒlastEffect, nextEffect function completeUnitOfWork (workInProgress) { const returnFiber = workInProgress.return if (!returnFiber.firstEffect) { returnFiber.firstEffect = workInProgress.firstEffect } if (workInProgress.lastEffect) { if (returnFiber.lastEffect) { returnEffect.lastEffect.nextEffect = workInProgress.lastEffect } returnEffect.lastEffect = workInProgress.lastEffect } if (workInProgress.effectTag) { if (returnFiber.lastEffect) { returnFiber.lastEffect.nextEffect = workInprogress } else { returnFiber.firstEffect = workInProgress } returnFiber.lastEffect = workInProgress } } commitRoot æ›´æ–°UI function commitRoot () { const nextEffect = workInProgressRoot.firstEffect while (nextEffect) { nextEffect.return.stateNode.appendChild(nextEffect.stateNode) nextEffect = nectEffect.return } } Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-10-29 14:39:49 "},"interview/react/3/1.html":{"url":"interview/react/3/1.html","title":"antd4 rc-field-formå¦‚ä½•å®ç°çš„","keywords":"","body":" å­¦ä¹  rc-field-form çš„å‡ ä¸ªçŸ¥è¯†ç‚¹ å®ç°Formç»„ä»¶çš„æ•°æ®ä¸Šä¸‹æ–‡é«˜é˜¶ç»„ä»¶ å®ç°Formç»„ä»¶ä¸­çš„æ•°æ®æ‰˜ç®¡ å®ç°Formç»„ä»¶ä¸­çš„åŒå‘æ•°æ®ç»‘å®š å®ç°Formç»„ä»¶ä¸­çš„å¼ºåˆ¶æ›´æ–° å®ç°Formç»„ä»¶ä¸­çš„å¼‚æ­¥è¡¨å•æ ¡éªŒ rc-field-form çš„ä½¿ç”¨ import Form, { Field } from 'rc-field-form' const validateUniqueName = (name, value) => { return new Promise(resolve => { setTimeout(() => { resolve(value === 'xiur' ? `${name} is not unique` : '') }, 3000) }) } { console.log('æˆåŠŸï¼š', values) }} onFinishFailed={(error) => { console.log('å¤±è´¥ï¼š', error) }} > å®ç°é€»è¾‘ Form ç»„ä»¶ å®ä¾‹åŒ– formInstance åˆå§‹åŒ– store è®¾ç½® callbacks ä½¿ç”¨ context Field ç»„ä»¶ è·å– context å…‹éš† children é‡å†™ props æ³¨å†Œ Field å£°æ˜ onStateChangeï¼Œstore æ”¹å˜ forceUpdate useForm useForm è¿”å› formInstance FormStore æ•°æ®æ‰˜ç®¡ async-validate æ•°æ®æ ¡éªŒ Form å®ç° å¦‚ä½•å®ç°åˆå§‹å€¼åªè®¾ç½®ä¸€æ¬¡ï¼Ÿåœºæ™¯ï¼šæ¯”å¦‚å¤–éƒ¨çš„çˆ¶ç»„ä»¶æ›´æ–°ï¼Œä¼šé€ æˆ Form ç»„ä»¶çš„æ›´æ–°ï¼Œæ­¤æ—¶ä¼šé‡æ–°è®¾ç½® initialValueï¼Œå¯æ˜¯æ­¤æ—¶å·²ç»ä¸æ˜¯åˆå§‹åŒ–äº†ä½¿ç”¨ React.useRef å•ä¾‹è§£å†³è¿™ä¸ªé—®é¢˜ const FieldContext = React.createContext() const Form = ({ initialValues, onFinish, onFinishFailed, children }) => { const [ formInstance ] = useForm() const mountRef = React.useRef(null) if(!mountRef.current) { formInstance.setInitialValues(initialValues) formInstance.setCallbacks({ onFinish, onFinishFailed }) mountRef.current = true } return {children} } useForm å®ç° class FormStore { constructor (forceRootUpdate) { this.forceRootUpdate = forceRootUpdate this.store = {} this.callbacks = {} this.fieldEntities = [] } setCallbacks = callbacks => { this.callbacks = {...callbacks} } setInitialValues = store => { this.store = {...store} } setFieldValue = (name, value) => { this.store[name] = value this.notify() } getFieldValue = name => { return this.store[name] } registerField = (fieldEntity) => { this.fieldEntities.push(fieldEntity) } notify = () => { for (let fieldEntity of this.fieldEntities) { fieldEntity.onStateChange() } } submit = () => { const descriptor = {} this.fieldEntities.forEach(fieldEntity => { const { name, rules } = fieldEntity.props if (rules) { const ruleInfo = {} rules.forEach(rule => { const ruleKeys = Object.keys(rule) ruleKeys.forEach(ruleKey => { ruleInfo[ruleKey] = rule[ruleKey] }) }) descriptor[name] = ruleInfo } }) new Schema(descriptor).validate(this.store) .then(values => { this.callbacks.onFinish(values) }) .catch(error => { this.callbacks.onFinishFailed(error) }) } getForm = () => { return { setInitialValues: this.setInitialValues, setCallbacks: this.setCallbacks, setFieldValue: this.setFieldValue, getFieldValue: this.getFieldValue, registerField: this.registerField, submit: this.submit, } } } function useForm () { const formRef = React.useRef(null) const [, forceUpdate] = React.useState() if (!formRef.current) { const formStore = new FormStore(forceUpdate) const formInstance = formStore.getForm() formRef.current = formInstance } return [formRef.current] } async-validate å®ç° class Schema { constructor (descriptor) { this.descriptor = descriptor } validate () { return new Promise(async (resolve, reject) => { let errorInfo = [] const fieldNames = Object.keys(this.descriptor) for (let i = 0; i filedRules[fieldRuleName]) { errors.push(`${fieldName} æœ€å¤§ä¸º${filedRules[fieldRuleName]}ä½å­—ç¬¦`) } break case 'validate': const validateFn = filedRules[fieldRuleName] const result = await validateFn(fieldName, values[fieldName]) if (result.length > 0) { errors.push(result) } } } errors.length > 0 ? errorInfo.push({ name: fieldName, errors }) : void(0) } errorInfo.length > 0 ? reject({ errorInfo, values }) : resolve(values) }) } } Field å®ç° è¿™é‡Œä¸»è¦å®ç° åŒå‘æ•°æ®ç»‘å®š å’Œ å¼ºåˆ¶åˆ·æ–° input çš„ value çš„è·å– ä» this.context é€šè¿‡ getFiledValue è·å– å½“ onChange è§¦å‘é€šè¿‡ setFieldValue æ”¹å˜ store æ—¶ï¼Œéœ€è¦æ›´æ–°UIï¼Œå°±é€šè¿‡ store çš„ notify è°ƒç”¨å„ä¸ª Field çš„ onStateChange å®ç° class Field extends React.Component { static contextType = FieldContext componentDidMount () { const formInstance = this.context formInstance.registerField(this) } onStateChange = () => { this.forceUpdate } getControlled = () => { const formInstance = this.context const { name, children } = this.props return React.cloneElement(children, { ...children.props, value: formInstance.getFieldValue(name), onChange: (e) => { formInstance.setFieldValue(name, e.target.value) } }) } render () { return this.getControlled() } } Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-11-04 15:16:15 "},"interview/react/4/1.html":{"url":"interview/react/4/1.html","title":"ä»createElementï¼Œrenderï¼ŒFunctional Component, Class Componentè§’åº¦å¼€å‘ä¸€ä¸ªReact","keywords":"","body":" è§£ç­” jsxæ˜¯ä»€ä¹ˆï¼Ÿ javascript + xmlï¼Œç”¨æ¥æè¿°é¡µé¢ä¸Šå…ƒç´ å’Œç»“æ„ï¼Œé‚£ä¹ˆ jsx ä¼šè¢«è½¬æ¢æˆä»€ä¹ˆï¼Ÿ babel ast ç¼–è¯‘ï¼šhttps://babeljs.io/repl æ™®é€šå…ƒç´ çš„ç¼–è¯‘ æ—¶é’Ÿï¼š {new Date().toLocalString()} React.createElement( \"div\", null, React.createElement(\"span\", null, \"\\u65F6\\u949F\\uFF1A\"), React.createElement(\"span\", null, new Date().toLocalString()) ) ç»„ä»¶çš„ç¼–è¯‘ React.createElement(Clock, { name: 'æ—¶é’Ÿ' }) æ€»ç»“ å¯ä»¥çœ‹åˆ° jsx ä¼šè¢«ç¼–è¯‘ä¸º React.createElementï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆç”¨åˆ° jsx çš„æ–‡ä»¶éƒ½è¦æ‰‹åŠ¨ import react jsx æ˜¯ javascript + xml ç”¨æ¥æè¿°é¡µé¢ç»“æ„çš„ä¸€ç§è¯­æ³• jsx ä¼šè¢« babel-loader ç¼–è¯‘æˆ React.createElement æ–¹æ³•æ‰§è¡Œç”Ÿæˆ virtual dom ç®€å•å®ç°ä¸€ä¸ªreactï¼Œæ»¡è¶³åˆ›å»ºè™šæ‹Ÿ dom å’Œæ¸²æŸ“çš„ç›®æ ‡ jsx æ–‡ä»¶ç¼–è¯‘ä¹‹åå¦‚ä¸‹ï¼š const ClockJsx = React.createElement('div', { className: 'jsx' }, 'æ—¶é’Ÿ1ï¼š', new Date().toLocalString()); const Clock1 = ({ name }) => return React.createElement('div', { className: 'functional' }, name, new Date().toLocalString()); class Clock2 extends React.Component { render () { return React.createElement('div', { className: 'class' }, name, new Date().toLocalString()); } } ReactDOM.render(React.createElement( 'div', null, ClockJsx, Clock1, Clock2, ), document.getElementById('root')) createElement æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š type: string props: object | null children ?: string | Array ä½œç”¨ï¼šæ„å»º virtual dom // react.js function createElement (type, props, ...children) { const childrenLength = children.length; if (childrenLength === 1) { props.children = children[0]; } else if (childrenLength > 1) { props.children = children } return ReactElement(type, props); } function ReactElement (type, props) { return { type, props } } export default { createElement, } render render ä¼šæŠŠ createElement çš„ç»“æœæ¸²æŸ“åˆ°é¡µé¢ï¼Œæ‹¿ class ç»„ä»¶ä¸¾ä¾‹ createElement çš„ç»“æœå¦‚ä¸‹ { type: 'div', props: { className: 'class', children: [ name, new Date().toLocalString() ] } } ç¬¬ä¸€ç‰ˆ render å®ç°ï¼š function render (VNode, parentNode) { if (typeof VNode === 'string') { return parentNode.appendChild(document.createTextNode(VNode)); } let { type, props } = VNode; const currentEl = document.createElement(type); for (let prop in props) { switch (prop) { case 'className': currentEl.className = props.className; break; case 'style': Object.keys(props.style).forEach(styleName => { currentEl.style[styleName] = props.style[styleName] }); break; case 'value': if (['input', 'textarea'].includes(type)) { currentEl.value = value; } else { currentEl.setAttribute('value', props.value); } break; case 'children': if (Array.isArray(props.children)) { props.children.forEach(child => render(child, currentEl)); } else { render(prosp.children, currentEl); } break; default: currentEl.setAttribute(prop, props.prop); break; } } parentNode.appendChild(currentEl); } å‡½æ•°ç»„ä»¶å’Œç±»ç»„ä»¶çš„ render æ”¯æŒ å‡½æ•°ç»„ä»¶å’Œç±»ç»„ä»¶ä¸æ™®é€š JSX çš„åŒºåˆ«åœ¨äº typeï¼Œtype ä¸€èˆ¬ä¸ºèŠ‚ç‚¹åç§°ï¼Œå¯æ˜¯å‡½æ•°ç»„ä»¶ type ä¸ºå‡½æ•°åï¼Œç±»ç»„ä»¶ type ä¸ºç±»å åœ¨è·å– type ä¹‹åï¼Œåˆ¤æ–­æ˜¯å‡½æ•°ç»„ä»¶ æˆ– ç±»ç»„ä»¶ï¼Œåˆ†åˆ«è·å–å…¶JSXï¼Œç„¶åèµ°æ™®é€šJSXçš„é€»è¾‘ let { type, props } = VNode; if (typeof type === 'function') { const functionalJsx = type(props); type = functionalJsx.type; props = functionalJsx.props; } if (type.isReactComponent) { const classJsx = new type(props).render(); type = classJsx.type; props = classJsx.props; } ç±»ç»„ä»¶è¿˜éœ€è¦å®ç°ä¸€ä¸ªåŸºç±» React.Component React.Component class Component { static isReactComponent = true; constructor (props) { this.props = props; } } export default { createElement, Component, } Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-11-27 16:03:50 "},"interview/react/5/1.html":{"url":"interview/react/5/1.html","title":"React Refçš„ä½¿ç”¨","keywords":"","body":" è§£ç­” æœ€æ–°ç‰ˆæœ¬ ref ä½¿ç”¨ this.inputRef = React.createRef() ref å¼•ç”¨å€¼ å¦‚ä½• ref={this.inputRef} åŠ è½½æ™®é€šå…ƒç´ ä¸Šï¼Œé‚£ä¹ˆ ref æ˜¯ dom èŠ‚ç‚¹ å¦‚æœå®ƒåŠ åœ¨å­ç»„ä»¶ä¸Šï¼Œref æ˜¯å­ç»„ä»¶å®ä¾‹ createRef å®ç° function createRef () { return { current: null } } å‡½æ•°ç»„ä»¶å¦‚ä½•ä½¿ç”¨ Ref const FunctionalComponent = React.forwardRef((props, ref) => { return {props.label} }) this.btnRef = React.createRef(); forwardRef è‡ªå®šä¹‰å®ç° function forwardRef (FuncComponent) { return (props) => { const ref = props.ref return FuncComponent(props, ref); } } Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-11-30 11:47:48 "},"interview/react/6/1.html":{"url":"interview/react/6/1.html","title":"æœ‰å“ªäº›ç”Ÿå‘½å‘¨æœŸ","keywords":"","body":" è§£ç­” è€çš„ç”Ÿå‘½å‘¨æœŸ åˆå§‹åŒ–ï¼šconstructor è£…è½½ï¼šcomponentWillMountï¼Œrenderï¼ŒcomponentDidMount æ›´æ–°ï¼šcomponentWillReceivePropsï¼ŒshouldComponentUpdateï¼ŒcomponentWillUpdateï¼Œrenderï¼ŒcomponentDidUpdate å¸è½½ï¼šcomponentWillUnmount æ–°çš„ç”Ÿå‘½å‘¨æœŸ åˆå§‹åŒ–ï¼šconstructor è£…è½½ï¼šgetDerivedStateFromPropsï¼Œrender æ›´æ–°ï¼šgetDerivedStateFromPropsï¼ŒshouldComponentï¼Œrenderï¼ŒgetSnapshotBeforeUpdateï¼ŒcomponentDidUpdate componentWillmount ç”Ÿå‘½å‘¨æœŸæ”¹åŠ¨ åºŸé™¤äº†ä¸‰ä¸ª will ç³»ç”Ÿå‘½å‘¨æœŸï¼šcomponentWillMountï¼ŒcomponentWillReceivePropsï¼ŒcomponentWillUpdate å¢åŠ äº†ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸï¼šgetDerivedStateFromPropsï¼ŒgetSnapshotBeforeUpdate getDerivedStateFromProps å½“åˆå§‹åŒ–å’Œæ›´æ–°æ—¶ï¼Œç»„ä»¶ä¼šåœ¨ constructor ä¹‹åå…ˆèµ° getDerivedStateFromPropsï¼Œå¯ä»¥åœ¨è¿™ä¸ªç”Ÿå‘½å‘¨æœŸä¸­è¿”å›ä¸€ä¸ªjsonï¼Œæ˜ å°„ä¸ºå½“å‰çš„state class Child extends React.Component { constructor (props) { super(props); this.state = { time: '' } } static getDerivedStateFromProps (nextProps) { return { time: nextProps.time } } } getSnapshotBeforeUpdate åœ¨æ›´æ–°ä¹‹å‰è¿”å›ä¸€ä¸ªå¿«ç…§ snapshotï¼Œå¯ä»¥åœ¨ componentDidUpdate ä¸­ç¬¬ä¸‰ä¸ªå‚æ•°è·å– getSnapshotBeforeUpdate () { return {} } componentDidUpdate (prevProps, prevState, snapshot) { } ä½¿ç”¨åœºæ™¯ï¼šæ¯”å¦‚å¾€ç½‘é¡µå¤´éƒ¨æ’å…¥å…ƒç´ ï¼Œä¼šå¯¼è‡´ç½‘é¡µå¾€ä¸‹ç§»ï¼Œæ­¤æ—¶å¯ä»¥ç”¨ getSnapshotBeforeUpdate å…ˆè®°å½•æ›´æ–°å‰çš„ scrollTop Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-11-30 14:48:48 "},"interview/react/7/1.html":{"url":"interview/react/7/1.html","title":"å¦‚ä½•å¼€å‘ä¸€ä¸ª redux","keywords":"","body":" Redux çš„åŸºç¡€åº”ç”¨ åŸºç¡€çš„å››ä¸ªæ–¹æ³•ï¼šcreateStoreï¼ŒgetStateï¼Œsubscribeï¼Œdispatch function reducer (state, action) { switch (action.type) { case 'ADD': return ++state; case 'MINUS': return --state; default: return state; } } const store = createStore(reducer, initialState); const unsubscribe = store.subscribe(() => { console.log('stateå‘ç”Ÿå˜åŒ–äº†', store.getState()); }) store.dispatch({ type: 'ADD' }); unsubscribe(); åŸºç¡€æ¶æ„å®ç° éœ€è¦æ³¨æ„çš„ç‚¹ï¼š å¦‚ä½•é˜²æ­¢ unsubscribe å¤šæ¬¡è°ƒç”¨ å¦‚ä½•åˆ¤æ–­æ˜¯å¦æ˜¯ä¸ªçº¯å¯¹è±¡ function createStore (reducer, initialState) { let currentState = initialState; let currentReducer = reducer; let currentListeners = []; function getState () { return currentState; } function subscribe (listener) { if (typeof listener !== 'function') { throw new Error('è®¢é˜…å‚æ•°å¿…é¡»ä¸ºå‡½æ•°') } let idx = currentListeners.push(listener); let isSubscribed = true; function unsubscribe () { if (!isSubscribe) { return } currentListeners.splice(idx - 1, 1); isSubscribe = false } } function dispatch (action) { if (!isPlainObject(action)) { throw new Error('action å¿…é¡»æ˜¯ä¸ªçº¯å¯¹è±¡') } if (!action || action.type) { throw new Error('action å¿…é¡»è¦æœ‰ä¸€ä¸ªtypeå±æ€§') } currentState = currentReducer(currentState, action); for (let listener of currentListeners) { listener(); } } return { getState, dispatch, subscribe, } } çº¯å¯¹è±¡ å¯¹è±¡çš„åŸå‹æ˜¯ Object.prototype function isPlainObject (obj) { if (typeof obj !== 'object' || obj === null) { return false; } return Object.getPrototypeOf(obj) === Object.prototype } Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-11-30 19:27:21 "}}