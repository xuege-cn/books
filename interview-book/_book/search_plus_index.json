{"./":{"url":"./","title":"Introduction","keywords":"","body":"Introduction Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-07-03 16:08:07 "},"knowledge/":{"url":"knowledge/","title":"çŸ¥è¯†æ˜Ÿçƒ","keywords":"","body":"çŸ¥è¯†æ˜ŸçƒðŸŒ è¿™é‡Œè®°å½•äº†å„ç§çŸ¥è¯†åˆ†ç±» Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-07-06 19:41:25 "},"knowledge/typescript/":{"url":"knowledge/typescript/","title":"typescript","keywords":"","body":"Typescript Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-09-18 16:43:34 "},"knowledge/typescript/1/1.html":{"url":"knowledge/typescript/1/1.html","title":"ç¼–è¯‘ä¸Šä¸‹æ–‡","keywords":"","body":"ç¼–è¯‘ä¸Šä¸‹æ–‡ å‘Šè¯‰Typescriptå“ªäº›æ–‡ä»¶æœ‰æ•ˆï¼Œå“ªäº›æ˜¯æ— æ•ˆçš„ åŸºç¡€ é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºtsconfig.json {} æ­¤ç›®å½•å’Œå­ç›®å½•ä¸‹çš„æ‰€æœ‰.tsæ–‡ä»¶ä¼šè¢«ä½œä¸ºç¼–è¯‘ä¸Šä¸‹æ–‡çš„ä¸€éƒ¨åˆ† ç¼–è¯‘ è¿è¡Œtscï¼Œä¼šåœ¨å½“å‰ç›®å½•æˆ–è€…çˆ¶çº§ç›®å½•å¯»æ‰¾tsconfig.json tsc -p ./path-to-project-directory tsc -w è§‚æµ‹æ¨¡å¼ æ˜¾ç¤ºæŒ‡å®šç¼–è¯‘å“ªäº›æ–‡ä»¶ å…·ä½“æŒ‡å®šæŸä¸ªæ–‡ä»¶ { files: [ \"./some/file.ts\" ] } æŒ‡å®šincludeå’Œexcludeæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ { include: [ \"./folder\" ], exclude: [ \"./folder/someFolder\", \"./folder/index.ts\" ] } å…¶ä»–çš„é…ç½®é¡¹ { \"compilerOptions\": { /* åŸºæœ¬é€‰é¡¹ */ \"target\": \"es5\", // æŒ‡å®š ECMAScript ç›®æ ‡ç‰ˆæœ¬: 'ES3' (default), 'ES5', 'ES6'/'ES2015', 'ES2016', 'ES2017', or 'ESNEXT' \"module\": \"commonjs\", // æŒ‡å®šä½¿ç”¨æ¨¡å—: 'commonjs', 'amd', 'system', 'umd' or 'es2015' \"lib\": [], // æŒ‡å®šè¦åŒ…å«åœ¨ç¼–è¯‘ä¸­çš„åº“æ–‡ä»¶ \"allowJs\": true, // å…è®¸ç¼–è¯‘ javascript æ–‡ä»¶ \"checkJs\": true, // æŠ¥å‘Š javascript æ–‡ä»¶ä¸­çš„é”™è¯¯ \"jsx\": \"preserve\", // æŒ‡å®š jsx ä»£ç çš„ç”Ÿæˆ: 'preserve', 'react-native', or 'react' \"declaration\": true, // ç”Ÿæˆç›¸åº”çš„ '.d.ts' æ–‡ä»¶ \"sourceMap\": true, // ç”Ÿæˆç›¸åº”çš„ '.map' æ–‡ä»¶ \"outFile\": \"./\", // å°†è¾“å‡ºæ–‡ä»¶åˆå¹¶ä¸ºä¸€ä¸ªæ–‡ä»¶ \"outDir\": \"./\", // æŒ‡å®šè¾“å‡ºç›®å½• \"rootDir\": \"./\", // ç”¨æ¥æŽ§åˆ¶è¾“å‡ºç›®å½•ç»“æž„ --outDir. \"removeComments\": true, // åˆ é™¤ç¼–è¯‘åŽçš„æ‰€æœ‰çš„æ³¨é‡Š \"noEmit\": true, // ä¸ç”Ÿæˆè¾“å‡ºæ–‡ä»¶ \"importHelpers\": true, // ä»Ž tslib å¯¼å…¥è¾…åŠ©å·¥å…·å‡½æ•° \"isolatedModules\": true, // å°†æ¯ä¸ªæ–‡ä»¶ä½œä¸ºå•ç‹¬çš„æ¨¡å— ï¼ˆä¸Ž 'ts.transpileModule' ç±»ä¼¼ï¼‰. /* ä¸¥æ ¼çš„ç±»åž‹æ£€æŸ¥é€‰é¡¹ */ \"strict\": true, // å¯ç”¨æ‰€æœ‰ä¸¥æ ¼ç±»åž‹æ£€æŸ¥é€‰é¡¹ \"noImplicitAny\": true, // åœ¨è¡¨è¾¾å¼å’Œå£°æ˜Žä¸Šæœ‰éšå«çš„ anyç±»åž‹æ—¶æŠ¥é”™ \"strictNullChecks\": true, // å¯ç”¨ä¸¥æ ¼çš„ null æ£€æŸ¥ \"noImplicitThis\": true, // å½“ this è¡¨è¾¾å¼å€¼ä¸º any ç±»åž‹çš„æ—¶å€™ï¼Œç”Ÿæˆä¸€ä¸ªé”™è¯¯ \"alwaysStrict\": true, // ä»¥ä¸¥æ ¼æ¨¡å¼æ£€æŸ¥æ¯ä¸ªæ¨¡å—ï¼Œå¹¶åœ¨æ¯ä¸ªæ–‡ä»¶é‡ŒåŠ å…¥ 'use strict' /* é¢å¤–çš„æ£€æŸ¥ */ \"noUnusedLocals\": true, // æœ‰æœªä½¿ç”¨çš„å˜é‡æ—¶ï¼ŒæŠ›å‡ºé”™è¯¯ \"noUnusedParameters\": true, // æœ‰æœªä½¿ç”¨çš„å‚æ•°æ—¶ï¼ŒæŠ›å‡ºé”™è¯¯ \"noImplicitReturns\": true, // å¹¶ä¸æ˜¯æ‰€æœ‰å‡½æ•°é‡Œçš„ä»£ç éƒ½æœ‰è¿”å›žå€¼æ—¶ï¼ŒæŠ›å‡ºé”™è¯¯ \"noFallthroughCasesInSwitch\": true, // æŠ¥å‘Š switch è¯­å¥çš„ fallthrough é”™è¯¯ã€‚ï¼ˆå³ï¼Œä¸å…è®¸ switch çš„ case è¯­å¥è´¯ç©¿ï¼‰ /* æ¨¡å—è§£æžé€‰é¡¹ */ \"moduleResolution\": \"node\", // é€‰æ‹©æ¨¡å—è§£æžç­–ç•¥ï¼š 'node' (Node.js) or 'classic' (TypeScript pre-1.6) \"baseUrl\": \"./\", // ç”¨äºŽè§£æžéžç›¸å¯¹æ¨¡å—åç§°çš„åŸºç›®å½• \"paths\": {}, // æ¨¡å—ååˆ°åŸºäºŽ baseUrl çš„è·¯å¾„æ˜ å°„çš„åˆ—è¡¨ \"rootDirs\": [], // æ ¹æ–‡ä»¶å¤¹åˆ—è¡¨ï¼Œå…¶ç»„åˆå†…å®¹è¡¨ç¤ºé¡¹ç›®è¿è¡Œæ—¶çš„ç»“æž„å†…å®¹ \"typeRoots\": [], // åŒ…å«ç±»åž‹å£°æ˜Žçš„æ–‡ä»¶åˆ—è¡¨ \"types\": [], // éœ€è¦åŒ…å«çš„ç±»åž‹å£°æ˜Žæ–‡ä»¶ååˆ—è¡¨ \"allowSyntheticDefaultImports\": true, // å…è®¸ä»Žæ²¡æœ‰è®¾ç½®é»˜è®¤å¯¼å‡ºçš„æ¨¡å—ä¸­é»˜è®¤å¯¼å…¥ã€‚ /* Source Map Options */ \"sourceRoot\": \"./\", // æŒ‡å®šè°ƒè¯•å™¨åº”è¯¥æ‰¾åˆ° TypeScript æ–‡ä»¶è€Œä¸æ˜¯æºæ–‡ä»¶çš„ä½ç½® \"mapRoot\": \"./\", // æŒ‡å®šè°ƒè¯•å™¨åº”è¯¥æ‰¾åˆ°æ˜ å°„æ–‡ä»¶è€Œä¸æ˜¯ç”Ÿæˆæ–‡ä»¶çš„ä½ç½® \"inlineSourceMap\": true, // ç”Ÿæˆå•ä¸ª soucemaps æ–‡ä»¶ï¼Œè€Œä¸æ˜¯å°† sourcemaps ç”Ÿæˆä¸åŒçš„æ–‡ä»¶ \"inlineSources\": true, // å°†ä»£ç ä¸Ž sourcemaps ç”Ÿæˆåˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè¦æ±‚åŒæ—¶è®¾ç½®äº† --inlineSourceMap æˆ– --sourceMap å±žæ€§ /* å…¶ä»–é€‰é¡¹ */ \"experimentalDecorators\": true, // å¯ç”¨è£…é¥°å™¨ \"emitDecoratorMetadata\": true // ä¸ºè£…é¥°å™¨æä¾›å…ƒæ•°æ®çš„æ”¯æŒ } } Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-09-18 16:58:11 "},"knowledge/typescript/2/1.html":{"url":"knowledge/typescript/2/1.html","title":"é…ç½®é¡¹","keywords":"","body":"é…ç½®é¡¹ target { \"target\": \"ES6\" } æ¯”å¦‚ const tag = Symbol('tag') targeté…ç½®ä¸ºES6æ—¶å¯ä»¥æ­£å¸¸ç¼–è¯‘ï¼Œé…ç½®ä¸ºES5åŠä»¥ä¸‹æ—¶ï¼Œtscç¼–è¯‘ä¼šæŠ¥é”™ Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-09-22 16:49:21 "},"knowledge/typescript/3/1.html":{"url":"knowledge/typescript/3/1.html","title":"å£°æ˜Žç©ºé—´","keywords":"","body":"å£°æ˜Žç©ºé—´ tsä¸­å­˜åœ¨ä¸¤ç§å£°æ˜Žç©ºé—´ï¼š ç±»åž‹å£°æ˜Žç©ºé—´ å˜é‡å£°æ˜Žç©ºé—´ ç±»åž‹å£°æ˜Žç©ºé—´ class Foo {} interface Bar {} type Bas = {} // å¯ä»¥ä½œä¸ºç±»åž‹æ³¨è§£ä½¿ç”¨ï¼š let foo: Foo let bar: Bar let bas: Bas // ä½†ä¸èƒ½ä½œä¸ºå˜é‡ä½¿ç”¨ï¼š const bar = Bar âŒ å˜é‡å£°æ˜Žç©ºé—´ class Foo {} const someVar = Foo // ä¸€äº›ç”¨varå£°æ˜Žçš„å˜é‡ï¼Œåªèƒ½åœ¨å˜é‡å£°æ˜Žç©ºé—´ä½¿ç”¨ã€‚ä¸èƒ½ç”¨ä½œç±»åž‹æ³¨è§£ const foo = 123; let bar: foo âŒ ä¸€äº›å¦‚interfaceå®šä¹‰çš„å†…å®¹ä¸èƒ½å½“ä½œå˜é‡ä½¿ç”¨ Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-09-22 17:12:36 "},"knowledge/typescript/4/1.html":{"url":"knowledge/typescript/4/1.html","title":"æ¨¡å—","keywords":"","body":"æ¨¡å— å…¨å±€æ¨¡å— åœ¨ç›¸åŒçš„é¡¹ç›®ä¸åŒæ–‡ä»¶ï¼Œtsç±»åž‹ç³»ç»Ÿå…è®¸ä½¿ç”¨å˜é‡ // 1.ts const a = '123' // 2.ts const a = '123' âŒ å°†ä¼šæŠ¥é”™ï¼Œaå·²è¢«å£°æ˜Ž æ–‡ä»¶æ¨¡å— åœ¨tsæ–‡ä»¶æ ¹çº§åˆ«ä½ç½®å«æœ‰importæˆ–exportï¼Œé‚£ä¹ˆä¼šåœ¨æ–‡ä»¶ä¸­åˆ›å»ºä¸€ä¸ªæœ¬åœ°çš„ä½œç”¨åŸŸ export const a = '123' è¿™å°±ä¼šè½¬ä¸ºæ–‡ä»¶æ¨¡å—äº†ï¼Œå˜é‡aä¸ä¼šä¸Žå…¶ä»–æ–‡ä»¶ä¸­çš„å˜é‡aå†²çª æ¨¡å—è·¯å¾„ ç›¸å¯¹æ¨¡å—è·¯å¾„ import foo from '../foo' åŠ¨æ€æŸ¥æ‰¾ import foo from 'foo' ./node_module/foo ../node_module/foo åŽç¼€æœç´¢è§„åˆ™ import foo from './foo' fooæ˜¯ä¸ªæ–‡ä»¶ï¼šfoo.ts fooæ˜¯ä¸ªæ–‡ä»¶å¤¹ foo/index.ts foo/package.json é‡å†™ç±»åž‹åŠ¨æ€æŸ¥æ‰¾ // é‡å†™ç±»åž‹åŠ¨æ€æŸ¥æ‰¾ declare module 'foo' { export var bar: number } import * as foo from 'foo' é…ç½®é¡¹ module typescriptçš„æ¨¡å—ç¼–è¯‘ï¼šcommonjsï¼Œamdï¼Œsystemï¼Œumdï¼Œes2015è¿™å‡ ç§æ–¹å¼æ‰“åŒ…å‡ºæ¥çš„æ•ˆæžœï¼š // commonjs exports.__esModule = true; exports.arr = void 0; exports.arr = [1, 2, 3]; // amd define([\"require\", \"exports\"], function (require, exports) { \"use strict\"; exports.__esModule = true; exports.arr = void 0; exports.arr = [1, 2, 3]; }); // system System.register([], function (exports_1, context_1) { \"use strict\"; var arr; var __moduleName = context_1 && context_1.id; return { setters: [], execute: function () { exports_1(\"arr\", arr = [1, 2, 3]); } }; }); // umd (function (factory) { if (typeof module === \"object\" && typeof module.exports === \"object\") { var v = factory(require, exports); if (v !== undefined) module.exports = v; } else if (typeof define === \"function\" && define.amd) { define([\"require\", \"exports\"], factory); } })(function (require, exports) { \"use strict\"; exports.__esModule = true; exports.arr = void 0; exports.arr = [1, 2, 3]; }); // es2015 export var arr = [1, 2, 3] Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-09-22 17:54:55 "},"knowledge/typescript/5/1.html":{"url":"knowledge/typescript/5/1.html","title":"å‘½åç©ºé—´","keywords":"","body":"å‘½åç©ºé—´ namespace Utility { export function log () {} export function error () {} } Utility.log('Call me') Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-09-22 18:56:58 "},"knowledge/typescript/6/1.html":{"url":"knowledge/typescript/6/1.html","title":"åŠ¨æ€å¯¼å…¥è¡¨è¾¾å¼","keywords":"","body":"åŠ¨æ€å¯¼å…¥è¡¨è¾¾å¼ ä½¿ç”¨module: esnexté€‰é¡¹ï¼štsä¿ç•™import()è¯­å¥ï¼Œç”¨äºŽwebpack Code Splitting import('moment').then(moment => { const time = moment().format() }) // tsconfig.jsoné…ç½® { \"compilerOptions\": { \"module\": \"esnext\" } } Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-09-22 19:02:12 "},"knowledge/typescript/7/1.html":{"url":"knowledge/typescript/7/1.html","title":"ç±»åž‹æ³¨è§£","keywords":"","body":"ç±»åž‹æ³¨è§£ åŽŸå§‹ç±»åž‹ï¼šstringï¼Œnumberï¼Œboolean æ•°ç»„ï¼šboolean[] æŽ¥å£ï¼š interface name = { firstName: string; lastName: string; } å†…è”ç±»åž‹æ³¨è§£ï¼š let name: { firstName: string; lastName: string; } ç‰¹æ®Šç±»åž‹ï¼š undefined, null, any, void æ³›åž‹ï¼š function reverse(items: T[]): T[] {} interface Array { reverse(): T[]; } è”åˆç±»åž‹ï¼š let conmand: string[] | string Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-09-22 19:26:07 "},"knowledge/webpack/5/1.html":{"url":"knowledge/webpack/5/1.html","title":"HMRåŽŸç†","keywords":"","body":" webpackçƒ­æ›´æ–°è‡ªå®šä¹‰å®žçŽ° æœåŠ¡ç«¯è¦åšä¸‰ä»¶äº‹ï¼š compiler ç›¸å…³å››ä»¶äº‹ compiler å¢žåŠ  done é’©å­å‡½æ•°ï¼Œç¼–è¯‘å®Œæˆè®°å½• hash å€¼ï¼Œå¹¶ socket å¹¿æ’­ æ›´æ–° compiler.options.entry æ³¨å…¥ webpack-dev-server/client.js å’Œ webpack/hot/dev-server.js è°ƒç”¨ compiler.hooks.entryOption.call(config.context, config.entry) æ›´æ–° entry compiler ä»¥ watch æ¨¡å¼å¯åŠ¨ compiler æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨ memory-fs å¯åŠ¨æœåŠ¡å™¨é…ç½®è·¯ç”± express æ–¹å¼å¯åŠ¨æœåŠ¡å™¨ é…ç½®è·¯ç”±ä¸­é—´ä»¶ æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨ memory-fs å¯åŠ¨ socket æœåŠ¡ ä»¥ server ä¸ºåŸºç¡€å¯åŠ¨socket.io ç›‘å¬è¿žæŽ¥ï¼Œä¿å­˜ socketï¼Œå¹¿æ’­ hash å’Œ ok å®¢æˆ·ç«¯è¦åšçš„ä¸‰ä»¶äº‹ï¼š æ³¨å…¥çš„ webpack-dev-server/client/index.js å»ºç«‹ socket è¿žæŽ¥ï¼Œç›‘å¬ hotï¼Œhashï¼Œok äº‹ä»¶ hash äº‹ä»¶ä¿å­˜ hash å€¼ hot äº‹ä»¶æ”¹å˜ hot å˜é‡ ok äº‹ä»¶ä¸­å‘å¸ƒ webpackHotUpdate äº‹ä»¶ æ³¨å…¥çš„ webpack/hot/dev-server.js è®¢é˜… webpackHotUpdate äº‹ä»¶ï¼Œå›žè°ƒä¸­æ‰§è¡Œ module.hot.checkï¼Œä¼ å…¥ hash å€¼ webpack æ‰“åŒ…ä»£ç  åœ¨ module å¯¹è±¡ä¸Šå¢žåŠ ä¸‰ä¸ªå±žæ€§ hot: { accept, check } parents children hotCreateRequire å°è£… webpack_requireï¼Œç»´æŠ¤ parents å’Œ children å±žæ€§ hotCheck å‘èµ· xhr è¯·æ±‚ ${hash}.hot-update.jsonï¼Œè¿”å›ž{ hash, c: { main: true } } åˆ›å»º script å‘èµ·æ–‡ä»¶è¡¥ä¸ jsonp è¯·æ±‚ ${chunkName}.${hash}.hot-update.js jsonp åŠ è½½è¿›å…¥ webpackHotUpdateï¼Œè¿”å›žæ•°æ®(chunkId, { chunkName: function () { æ–°ä»£ç  } }) æ›´æ–° modules ä¸­çš„è€ä»£ç  ä»Žç¼“å­˜ä¸­èŽ·å–å„ä¸ª chunk çš„è€ module åˆ é™¤ç¼“å­˜ä¸Šçš„è€ module ä»Žè€ module çš„çˆ¶ module ä¸Šæ‰¾åˆ° accept å›žè°ƒå¹¶æ‰§è¡Œ å…·ä½“ä»£ç å®žçŽ°ï¼šæˆ‘çš„ç¤ºä¾‹tipsï¼š è¡¥ä¸æ–‡ä»¶æ˜¯é€šè¿‡ webpack.HotModuleReplacementPlugin æ’ä»¶ç”Ÿæˆçš„ webpackçƒ­æ›´æ–°çš„ä½¿ç”¨ ä¸»æ–‡ä»¶: // index.js const input = document.createElement('input') document.body.append(input) const div = document.createElement('div') document.body.append(div) function render () { const data = require('./mock.js') div.innerHTML = data } render() if (module.hot) { module.hot.accept(['./mock.js'], render) } // mock.js module.exports = 'hello world' webpacké…ç½®æ–‡ä»¶ï¼š devServer: { hot: true } ä¾é module.hotä»¥åŠdevServer.hotå°±å¯ä»¥å®žçŽ°webpackçƒ­æ›´æ–°äº† webpackçƒ­æ›´æ–°æœåŠ¡ç«¯çš„å®žçŽ° æœåŠ¡ç«¯ä¹Ÿå³webpack-dev-serverï¼ŒæœåŠ¡ç«¯åšäº†å“ªäº›äº‹å‘¢ï¼Ÿ setupAppï¼Œåˆ›å»ºexpresså®žä¾‹ updateCompilerï¼Œä¼šå¾€å‰ç«¯jsä¸­æ³¨å…¥å¦å¤–ä¸¤ä¸ªjs setupHooksï¼Œç›‘å¬hooksç¼–è¯‘å®Œæˆäº‹ä»¶ï¼Œç¼–è¯‘å®Œæˆéœ€è¦å¹²ä»€ä¹ˆå‘¢ï¼Ÿ å­˜å‚¨hashå€¼ å¹¿æ’­æ‰€æœ‰socket hashå€¼ï¼Œä»¥åŠok setupDevMiddleware watchæ–¹å¼å¯åŠ¨compiler è¿”å›žè·¯ç”±ä¸­é—´ä»¶ routesï¼Œapp.useä¼ å…¥è·¯ç”±ä¸­é—´ä»¶ï¼Œè¿›è¡Œè·¯ç”± createServerï¼Œé€šè¿‡expresså®žä¾‹appåˆ›å»ºserver createSocketServerï¼Œé€šè¿‡serverå®žä¾‹åˆ›å»ºsocket.ioæœåŠ¡ ä¸‹é¢æ¥å®žçŽ°ä¸‹ï¼š webpack-dev-serverå¯åŠ¨æ–‡ä»¶ const Server = require('./server') const webpack = require('webpack') const config = require('webpack.config.js') const compiler = webpack(config) const server = new Server(compiler) server.listen(9090, () => { console.log('æœåŠ¡å™¨åœ¨ç«¯å£9090å¯åŠ¨äº†') }) setupApp åˆ›å»ºexpresså®žä¾‹ const express = require('express') setupApp () { this.app = express() } updateCompiler å¾€å®¢æˆ·ç«¯æ³¨å…¥js const path = require('path') function updateCompiler (compiler) { const config = compiler.options config.entry = { main: [ path.resolve(__dirname, './client/index.js'), path.resolve(__dirname, './hot/dev-server.js'), config.entry ] } } setupHooks æŒ‚è½½compiler.hooks.doneé’©å­å‡½æ•°ï¼Œæ‰“åŒ…å®Œæˆæ‰§è¡Œï¼š å­˜å‚¨hashå€¼ å‘å„ä¸ªsocketå¹¿æ’­ä¸¤ä¸ªäº‹ä»¶ï¼šhashï¼ŒoksetupHooks () { const { compiler } = this compiler.hooks.done.tap(stats => { this.currentHash = stats.hash this.clientSocketList.forEach(socket => { socket.emit('hash', stats.hash) socket.emit('ok') }) }) } setupDevMiddleware ä¸¤ä¸ªä½œç”¨ï¼š ä»¥watchæ–¹å¼å¯åŠ¨compiler è·¯ç”± æŠŠwebpackçš„æ–‡ä»¶è¾“å…¥ç³»ç»Ÿæ”¹ä¸ºmemory-fsï¼Œç›¸åŒè·¯ç”±è¯»å–ä¹Ÿä»Žmemory-fsè¯»å– this.middleware = this.setupDevMiddleware() const mime = require('mime') const path = require('path') const MemoryFs = require('memory-fs') setupDevMiddleware () { const { compiler } = this const staticDir = compiler.options.output.path compiler.watch({}, () => { console.log('compilerç›‘å¬æ¨¡å¼å¯åŠ¨') }) const fs = new MemoryFs() this.fs = compiler.outputFileSystem = fs return (req, res, next) => { let { url } = req if (url === '/favicon.ico') { res.senStatus(404) } url === '/' ? url = '/index.html' : null const filePath = path.resolve(staticDir, url) try { let statObj = this.fs.statSync(filePath) if (statObj.isFile()) { const content = this.fs.readFileSync(filePath) res.setHeader('Content-Type', mime.getType(filePath)) res.send(content) } else { res.senStatus(404) } } catch (e) { res.sendStatus(404) } } } routes è®¾ç½®è·¯ç”± routes () { const { app, middleware } = this app.use(middleware) } createServer createServer () { const { app } = this this.server = http.createServer(app) } createSocketServer createSocketServer () { const { server } = this const io = socketIO(server) io.on('connection', socket => { socket.emit('hash', this.currentHash) socket.emit('ok') this.clientSocketList.push(socket) io.on('disconnect', () => { const index = this.clientSocket.indexOf(socket) this.clientSocketList.spilce(index, 1) }) }) } Serveræž„é€ å‡½æ•° constructor () { this.setupApp(); updateCompiler(); this.clientSocketList = []; this.setupHooks(); this.setupDevMiddleware(); this.routes(); this.createServer(); this.createSocketServer(); } Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-09-23 17:38:11 "}}