{"./":{"url":"./","title":"Introduction","keywords":"","body":"Introduction Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-07-03 16:08:07 "},"knowledge/":{"url":"knowledge/","title":"çŸ¥è¯†æ˜Ÿçƒ","keywords":"","body":"çŸ¥è¯†æ˜Ÿçƒ ğŸŒ è¿™é‡Œè®°å½•äº†å„ç§çŸ¥è¯†åˆ†ç±» Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-09-27 10:37:32 "},"interview/webpack/":{"url":"interview/webpack/","title":"webpack","keywords":"","body":"webpack æ¯æ—¥ä¸€é¢˜ Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-10-10 10:49:13 "},"interview/webpack/1/1.html":{"url":"interview/webpack/1/1.html","title":"webpackåšè¿‡å“ªäº›ä¼˜åŒ–ï¼Ÿå¼€å‘æ•ˆç‡ï¼Œæ‰“åŒ…ç­–ç•¥ç­‰","keywords":"","body":" è§£ç­” Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-11-10 16:58:14 "},"interview/webpack/2/1.html":{"url":"interview/webpack/2/1.html","title":"HtmlWebpackPlugin çš„é…ç½®","keywords":"","body":" è§£ç­” filename new HtmlWebpackPlugin({ filename: 'order/index.html' }) title new HtmlWebpackPlugin({ title: 'Hello Webpack' }) template new HtmlWebpackPlugin({ template: 'template.html' }) templateContent inline html templateParameters new HtmlwebpackPlugin({ templateParameters: { __base_style__: ' .app { red } ' } }) inject inject: true | false | head | body true è·Ÿ body æ•ˆæœä¸€æ ·ï¼šåœ¨bodyæœ«å°¾æ³¨å…¥ falseï¼šä¸æ³¨å…¥ js headï¼šåœ¨ head ä¸­æ³¨å…¥ js publicPath è·Ÿ output publicPathï¼Œåœ¨è¾“å‡º js è·¯å¾„åŠ å…¥ publicPath scriptLoading blockingï¼š æ­£å¸¸æ³¨å…¥ js deferï¼šæ³¨å…¥ js æ·»åŠ  defer å±æ€§ scriptLoading: blocking | defer favicon æ³¨å…¥ faviconï¼Œâš ï¸ ï¼šéœ€è¦æ˜¯æœ¬åœ°çš„ï¼Œä¼šå¸¦ä¸Š publicPath å‰ç¼€ minify å‹ç¼©ï¼Œtrue | false hash js css icon éƒ½ä¼šå¸¦ä¸Š ?hashï¼Œå¯æœ‰æ•ˆæ¸…æ¥šç¼“å­˜ chunks æ³¨å…¥å“ªäº› js chunks: ['main'] chunksSortMode // æ’å…¥ html çš„å¾ˆå¤š chunksï¼Œå¦‚ä½•æ’åº chunks: ['index', 'main'], chunksSortMode: 'auto | manual' excludeChunks ä¸åŒ…å«çš„ chunks Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-11-09 15:03:00 "},"interview/webpack/3/1.html":{"url":"interview/webpack/3/1.html","title":"æœ‰å“ªäº›æœ‰ç”¨çš„ webpack æ’ä»¶","keywords":"","body":" Loader loader çš„ä½¿ç”¨æ–¹å¼ å¦‚æœä¸åœ¨ webpack.config.js ä¸­é…ç½® loaderï¼Œé‚£ä¹ˆæ€ä¹ˆä½¿ç”¨å‘¢ï¼Ÿ require('style-loader!css-loader!./index.css') file-loader å¤„ç†æ–‡ä»¶ æŠŠåŸå›¾ç‰‡æ‹·è´åˆ° distï¼Œæ–‡ä»¶åä¹Ÿä¼šå˜ å¯ä»¥å¤„ç†ä»»æ„äºŒè¿›åˆ¶æ•°æ® require('file-loader?outputPath=./images!./1.jepg') { test: /.png/, use: { loader: 'file-loader', options: { outputPath: '/images' } } } å…¨å±€æ³¨å…¥æ–¹æ¡ˆäºŒï¼šexpose-loader è¿™æ ·ä½¿ç”¨ï¼Œéœ€è¦æ‰‹åŠ¨ import jquery from 'jquery'ï¼›å½“ require è§£æåˆ°è¿™ä¸ª import æ—¶ï¼Œå°±ä¼šèµ° expose-loaderä½†æ˜¯å¥½å¤„æ˜¯ï¼šåªä¼šåœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­æ‰“åŒ… { test: require.resolve('jquery'), use: { loader: 'expose-loader', options: { exposes: { globalName: '$', override: true } } } } babel-loader babeléå¸¸æ…¢ï¼Œä¼˜åŒ–ä¸»è¦é€šè¿‡ä»¥ä¸‹ä¸¤ç‚¹ï¼š exclude æˆ–è€… include ç²¾ç¡®è§£æ cacheDirectory: true å¼€å¯ç¼“å­˜ { test: /.js$/, use: { loader: 'babel-loader', options: { presets: ['@babel/preset-env'] } } } cache-loader { test: /\\.js$/, use: [ 'cache-loader', 'babel-loader' ], include: path.resolve('src') } css-loader css-loader è§£é‡Š @import å’Œ url() Plugins CleanWebpackPlugin å¼€å‘æ—¶ dist ç›®å½•ä¸æ–­äº§å‡ºï¼Œæ–‡ä»¶å¾ˆå¤šå¾ˆä¹± const CleanWebpackPlugin = require('clean-webpack-plugin') new CleanWebpackPlugin(['dist']) ä¸å¸¦å‚æ•°çš„è¯ï¼Œä¼šæŠŠ output path ä½œä¸ºç›®æ ‡ç›®å½• å…¨å±€æ³¨å…¥æ–¹æ¡ˆä¸€ï¼šProvidePlugin ç¼ºç‚¹ï¼šæ¯”å¦‚ $: jqueryï¼Œä½¿ç”¨åˆ° $ çš„æ¨¡å—éƒ½ä¼šæ‰“åŒ…jqueryï¼Œé€ æˆé‡å¤æ‰“åŒ… é…ç½® noParse ä¹Ÿæ²¡ç”¨ const webpack = require('webpack') new webpack.ProvidePlugin({ $: 'jquery' }) extract-text-webpack-plugin const ExtractTextWebpackPlugin = require('extract-text-webpack-plugin') { test: /\\.css$/, use: ExtractTextWebpackPlugin.extract({ fallback: 'style-loader', use: 'css-loader' }) } plugins: [ new ExtractTextPlugin('style.css'), ] å¤šä¸ª css æ¨¡å— å¦‚ä½•å¤„ç†ï¼Ÿ const lessExtractPlugin = new ExtractTextWebpackPlugin('css/less.css') const cssExtractPlugin = new ExtractTextWebpackPlugin('css/css.css') const sassExtractPlugin = new ExtractTextWebpackPlugin('css/sass.css') // åŠ è½½å™¨ä»¥æ­¤ç±»æ¨ { test: /\\.css$/, use: cssExtractPlugin.extract({ fallback: 'style-loader', use: 'css-loader' }) } plugins: [ lessExtractPlugin, cssExtractPlugin, sassExtractPlugin, ] CopyWebpackPlugin const CopyWebpackPlugin = require('copy-webpack-plugin') new CopyWebpackPlugin({ from: path.join(__dirname, 'public'), to: path.join(__dirname, 'dist') }) AggressiveSplittingPlugin new webpack.optimize.AggressiveSplittingPlugin({ minSize: 30000, maxSize: 50000, chunkOverhead: 0, }) Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-11-09 19:41:18 "},"interview/webpack/4/1.html":{"url":"interview/webpack/4/1.html","title":"webpackåŠ¨æ€å¯¼å…¥ import æ˜¯å¦‚ä½•å®ç°çš„","keywords":"","body":" è§£ç­” åŠ¨æ€å¯¼å…¥ import ä½¿ç”¨ // index.js document.getElementById('app').addEventListener('click', () => { import('./console.js').then(_console => { _console.log('clicked') }) }) //console.js function log (msg) { console.log(`system log: ${msg}`) } export { log } webpack æ‰“åŒ…ä¹‹åçš„æ ·å­ // main.js { './index.js': function (module, __webpack_exports__, __webpack_require__) { document.getElementById('app').addEventListener('click', () => { __webpack_require__.e(0).then( __webpack_require__.bind(null, './console.js') ).then(_console_ => { _console_.log('clicked') }) }) } } // 0.js window.webpackJsonp = window.webpackJsonp || [] window.webpackJsonp.push([ [0], { './console.js': function (module, __webpack_exports__, __webpack_require__) { Object.defineProperty(__webpack_exports__, 'log', { enumerable: true, get: function () { return log } }) function log (msg) { console.log(msg) } } } ]) webpack_require çš„å®ç° (function (modules) { var installedModules = {}; function __webpack_require__ (moduleId) { if (installedModules[moduleId]) { return installedModules[moduleId] } var module = installedModules[moduleId] = { i: moduleId, l: false, exports: {} } modules[moduleId].call(module, module, module.exports, __webpack_require__) module.l = true return module.exports } })({ './index.js': function (){} }) webpack_require.eçš„å®ç° var installedChunks = {} __webpack_require__.e = function requireEnsuer (chunkId) { var promises = [] var installedChunkData = installedChunks[chunkId] if (installedChunkData !== 0) { if (installedChunkData) { promises.push(installedChunkData[2]) } else { var promise = new Promise((resolve, reject) => { installedChunkData = installedChunks[chunkId] = [resolve, reject] }) promises.push((installedChunkdata[2] = promise)) var script = document.createElement('script') script.src = `${chunkId}.js` document.head.appendChild(script) } } return Promise.all(promises) } window.webpackJsonp æ˜¯ä»€ä¹ˆï¼Ÿ window.webpackJsonp æ˜¯ä¸ªæ•°ç»„ï¼Œä½†æ˜¯ä¼ ç»Ÿ jsonp åº”è¯¥æ˜¯è°ƒç”¨å›è°ƒå‡½æ•°ï¼Œå¯æ˜¯æ‰“åŒ…ä¹‹åä»£ç ä¸ºä»€ä¹ˆæ˜¯ï¼šwindow.webpackJsonp.pushï¼Œå¦‚ä½•è§¦å‘å›è°ƒå‘¢ï¼Ÿ var jsonpArray = window.webpackJsonp = window.webpackJsonp || [] var parentJsonpFunction = jsonpArray.push.bind(jsonArray) jsonpArray.push = webpackJsonpCallback for (let jsonp of jsonpArray) { webpackJsonpCallback(jsonp) } å¯ä»¥çœ‹å‡º window.webpackJsonp.pushï¼Œå¦‚æœåœ¨main.jså·²åŠ è½½çš„æƒ…å†µä¸‹ï¼Œå…¶å®å·²ç»æ˜¯ webpackJsonpCallback å‡½æ•°äº† webpackJsonpCallback çš„å®ç° function webpackJsonpCallback (data) { const chunkIds = data[0] const moreModules = data[1] vat resolves = [] for (let chunkId of chunkIds) { resolves.push(installedChunks[chunkId][0]) installedChunks[chunkId] = 0 } for (let moduleName in moreModules) { modules[moduleName] = moreModules[moduleName] } if (parentJsonpFunction) parentJsonpFunction(data) while (resolves.length) { resolves.shift()() } } Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-11-12 16:06:53 "},"interview/webpack/5/1.html":{"url":"interview/webpack/5/1.html","title":"å¼€å‘ä¸€ä¸ªloaderï¼ŒæŠŠä»£ç ä¸­çš„ç®­å¤´å‡½æ•°ç¼–è¯‘ä¸ºæ™®é€šå‡½æ•°","keywords":"","body":" è§£ç­” const transformer = require(\"@babel/core\"); const t = require('@babel/types') module.exports = function(content, map, meta) { const ArrowFunctionToFunctionPlugin = { visitor: { ArrowFunctionExpression(path) { const ruturnStatement = t.returnStatement(path.node.body) const blockStatement = t.blockStatement([ruturnStatement]) const funcExpr = t.functionExpression(null, path.node.params, blockStatement) path.replaceWith(funcExpr) } } } const result = transformer.transform(content, { plugins: [ArrowFunctionToFunctionPlugin] }) return result.code } loaderçš„é…ç½® resolveLoader: { modules: [path.resolve(__dirname, 'loaders')], extensions: ['.js'], mainFields: ['loader'] } Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-11-13 15:58:45 "},"interview/webpack/6/1.html":{"url":"interview/webpack/6/1.html","title":"tapable çš„ä½¿ç”¨å’ŒåŸç†","keywords":"","body":" è§£ç­” SyncHook const { SyncHook } = require('tapable') const queue = new SyncHook(['n', 'a', 's']) queue.tap('1', function (name, age, sex) { console.log(name, age, sex) }) queue.tap('2', function (name, age) { console.log(name, age) }) queue.tap('3', function (name, age) { console.log(name, age) }) queue.call('1', 'xiur', 29, 'man') è‡ªå®šä¹‰å®ç°: class SyncHook { constructor () { this._plugins = {} } tap (name, callback) { (this._plugins[name] || (this._plugins[name] = [])).push(callback) } call (...args) { for (let pluginName in this._plugins) { let plugins = this._plugins[pluginName] for (let plugin of plugins) { plugin.apply(this, args) } } } } module.exports = SyncHook SyncBailHook const { SyncBailHook } = require('tapable') const queue = new SyncBailHook(['n', 'a', 's']) queue.tap('1', function (name, age, sex) { console.log(name, age, sex) return 'Wrong' }) queue.tap('2', function (name, age) { console.log(name, age) }) queue.tap('3', function (name, age) { console.log(name, age) }) queue.call('1', 'xiur', 29, 'man') è‡ªå®šä¹‰å®ç°ï¼š class SyncBailHook { constructor () { this._plugins = {} } tap (name, callback) { (this._plugins[name] || (this._plugins[name] = [])).push(callback) } call (...args) { for (let pluginName in this._plugins) { let plugins = this._plugins[pluginName] for (let plugin of plugins) { let result = plugin.apply(this, args) if (result) { return result } } } } } module.exports = SyncBailHook SyncWaterfallHook const { SyncWaterfallHook } = require('tapable') const queue = new SyncWaterfallHook(['n', 'a', 's']) queue.tap('1', function (name, age, sex) { console.log(name, age, sex) return name + '1' }) queue.tap('2', function (name, age) { console.log(name, age) return name + '2' }) queue.tap('3', function (name, age) { console.log(name, age) return name + '3' }) queue.call('xiur', 29, 'man') è‡ªå®šä¹‰å®ç°ï¼š class SyncWaterfallHook { constructor () { this._plugins = {} } tap (name, callback) { (this._plugins[name] || (this._plugins[name] = [])).push(callback) } call (init, ...args) { let current = init for (let pluginName in this._plugins) { let plugins = this._plugins[pluginName] for (let plugin of plugins) { current = plugin.apply(this, [current, ...args]) } } } } module.exports = SyncWaterfallHook SyncLoopHook const { SyncLoopHook } = require('tapable') const queue = new SyncLoopHook(['n', 'a', 's']) let count = 3; queue.tap('1', function (name, age, sex) { console.log(count) if (count > 0) { count--; return count } else { return } }) queue.call('xiur', 29, 'man') è‡ªå®šä¹‰å®ç°ï¼š class SyncLoopHook { constructor () { this._plugins = {} } tap (name, callback) { (this._plugins[name] || (this._plugins[name] = [])).push(callback) } call (...args) { for (let pluginName in this._plugins) { let plugins = this._plugins[pluginName] for (let plugin of plugins) { let result do { result = plugin.apply(this, args) } while (result !== undefined) } } } } module.exports = SyncLoopHook AsyncParalleHook å¼‚æ­¥å¹¶è¡ŒåŠ è½½ // const { AsyncParallelHook } = require('tapable') const AsyncParallelHook = require('./AsyncParallelHook') const hook = new AsyncParallelHook(['name']); console.time('cost'); hook.tapAsync('a', (name, cb) => { setTimeout(() => { console.log(`hello ${name}`); cb(); }, 2000) }) hook.tapPromise('a', name => { return new Promise((resolve) => { setTimeout(() => { console.log(`hello ${name}, again`); resolve(); }, 4000) }) }) hook.callAsync('a', () => { console.log('done'); console.timeEnd('cost'); }); è‡ªå®šä¹‰å®ç°ï¼š class AsyncParallelHook { constructor () { this._plugins = {}; } tapAsync (name, callback) { (this._plugins[name] || (this._plugins[name] = [])).push(function (...args) { const cb = args.pop(); callback.call(this, ...args, () => { ++this.i; if (this.i >= this._plugins[name].length) { return cb() } }); }) } tapPromise (name, callback) { (this._plugins[name] || (this._plugins[name] = [])).push(function (...args) { callback.apply(this, args).then(() => { const cb = args.pop(); ++this.i; if (this.i >= this._plugins[name].length) { return cb() } }) }) } callAsync (...args) { this.i = 0; for (let pluginName in this._plugins) { let plugins = this._plugins[pluginName] for (let plugin of plugins) { plugin.apply(this, args) } } } } module.exports = AsyncParallelHook AsyncSeriesHook å¼‚æ­¥ä¸²è¡ŒåŠ è½½ const { AsyncSeriesHook } = require('tapable'); const hook = new AsyncSeriesHook(['name']); console.time('cost'); hook.tapAsync('a', (name, cb) => { setTimeout(() => { console.log(`hello ${name}`); cb(); }, 2000); }); hook.tapPromise('a', (name) => { return new Promise((resolve) => { setTimeout(() => { console.log(`hello ${name}, again`); resolve(); }, 4000); }); }); hook.callAsync('a', () => { console.log('done'); console.timeEnd('cost'); }); è‡ªå®šä¹‰å®ç°ï¼š class AsyncSeriesHook { constructor () { this._plugins = {} this.next = this._next.bind(this) } tapAsync (name, callback) { (this._plugins[name] || (this._plugins[name] = [])).push(function (...args) { const cb = args.pop(); callback(...args, () => this.next(name, cb, [...args, cb])); }) } tapPromise (name, callback) { (this._plugins[name] || (this._plugins[name] = [])).push(function (...args) { const cb = args.pop(); callback(...args).then(() => this.next(name, cb, [...args, cb])) }) } _next (name, cb, args) { ++this.i; if (this.i >= this._plugins[name].length) { return cb(); } this._plugins[name][this.i].apply(this, args) } callAsync (...args) { this.i = 0 for (let pluginName in this._plugins) { let plugins = this._plugins[pluginName]; if (plugins) { plugins[0].apply(this, args) } } } } module.exports = AsyncSeriesHook AsyncSeriesBailHook å¼‚æ­¥ä¸²è¡Œç†”æ–­åŠ è½½ const { AsyncSeriesHook } = require('tapable'); const hook = new AsyncSeriesHook(['name']); console.time('cost'); hook.tapAsync('a', (name, cb) => { setTimeout(() => { console.log(`hello ${name}`); cb('yes'); }, 2000); }); hook.tapPromise('a', (name) => { return new Promise((resolve) => { setTimeout(() => { console.log(`hello ${name}, again`); resolve('yes'); }, 4000); }); }); hook.callAsync('a', () => { console.log('done'); console.timeEnd('cost'); }); class AsyncSeriesBailHook { constructor () { this._plugins = {} this.next = this._next.bind(this) } tapAsync (name, callback) { (this._plugins[name] || (this._plugins[name] = [])).push(function (...args) { const cb = args.pop(); callback(...args, ret => this.next(name, cb, [...args, cb], ret)); }) } tapPromise (name, callback) { (this._plugins[name] || (this._plugins[name] = [])).push(function (...args) { const cb = args.pop(); callback(...args).then(ret => this.next(name, cb, [...args, cb], ret)) }) } _next (name, cb, args, ret) { ++this.i; if (this.i >= this._plugins[name].length || ret !== undefined) { return cb(); } this._plugins[name][this.i].apply(this, args) } callAsync (...args) { this.i = 0 for (let pluginName in this._plugins) { let plugins = this._plugins[pluginName]; if (plugins) { plugins[0].apply(this, args) } } } } module.exports = AsyncSeriesBailHook Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-11-16 16:46:33 "},"interview/webpack/7/1.html":{"url":"interview/webpack/7/1.html","title":"style-loader çš„ä½¿ç”¨åŠåŸç†","keywords":"","body":" style-loader çš„ä½œç”¨ æŠŠ css æ’å…¥ html å¼€å‘é˜¶æ®µæ¨¡å—çƒ­æ›´æ–° style-loader å’Œ css-loader çš„å…³ç³» style-loader å’Œ css-loader ç»å¸¸ä¸€èµ·ä½¿ç”¨ï¼Œé‚£ä¹ˆä¸ä½¿ç”¨ css-loaderï¼Œåªç”¨ style-loader åŠ è½½ css è¡Œä¸è¡Œå‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¸è¡Œçš„ ğŸ™…â€â™‚ï¸ style-loader åªæ˜¯æŠŠ css æ’å…¥ htmlï¼Œä½†æ˜¯å¹¶ä¸ä¼šè§£æ css æ–‡ä»¶ é‚£ä¹ˆ webpack æ˜¯ä¸è®¤è¯† css æ–‡ä»¶çš„ï¼Œéœ€è¦ css-loader æ¥åŠ è½½ cssæ–‡ä»¶ css-loader æ¢æˆ less-loader ä¹Ÿæ˜¯æˆç«‹çš„ï¼Œå…¶ä½œç”¨å°±æ˜¯åŠ è½½ css æ–‡ä»¶ è¯•æƒ³ä¸€ä¸‹ å®ç° style-loaderéœ€è¦è§£å†³ä»€ä¹ˆé—®é¢˜ å¦‚ä½•æ‹¿åˆ° css-loader è§£æä¹‹åçš„æºç ï¼Ÿ å¦‚ä½•é¿å… css-loader çš„é‡å¤æ‰§è¡Œã€æ­»å¾ªç¯ã€‘ï¼Ÿ å¦‚ä½•æ”¯æŒçƒ­æ›´æ–°ï¼Ÿ å¯ä»¥å®è¡Œçš„ä¸€ç§æ–¹æ¡ˆï¼š æ¯æ¬¡çƒ­æ›´æ–°ï¼Œæ¯”å¦‚æ›´æ–°äº† index.cssï¼Œç½‘é¡µç«¯ä¼šæ”¶åˆ°ä¸€ä¸ªè¡¥ä¸åŒ…ï¼š./node_modules/css-loader/dist/cjs.js!./index.cssï¼Œç½‘é¡µç«¯æ”¶åˆ°è¡¥ä¸åŒ…ï¼Œä¼šå»æ›´æ–°è¿™ä¸ªæ¨¡å— å®¢æˆ·ç«¯ç›‘å¬ module.hot.accept('./node_modules/css-loader/dist/cjs.js!./index.css', function () {}) å›è°ƒå‡½æ•°ä¸­ï¼Œé‡æ–°è·å–è¿™ä¸ªæ¨¡å—ç„¶åè¿›è¡Œæ›´æ–° æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œå¦‚ä½•æ‰¾åˆ°æœ€åˆçš„é‚£ä¸ª style èŠ‚ç‚¹ï¼Œå®¢æˆ·ç«¯å°±éœ€è¦ç”¨ä¸€ä¸ªæ˜ å°„æ¥ä¿å­˜ styleInDomï¼Œæ˜ å°„çš„å€¼ä¸ºæ›´æ–°å‡½æ•°ï¼Œé”®æ˜¯å•¥ï¼Ÿ åŠ è½½ index.css æ’å…¥åˆ° htmlï¼Œé‚£ä¹ˆ index.css è¿™ä¸ªåç§°å°±å¯ä»¥ä½œä¸º key ä» style-loader çš„ä½¿ç”¨åˆ†æåŸç† style-loader çš„åº”ç”¨åœºæ™¯ï¼š loader: ['style-loader', 'css-loader'] webpack loader çš„æ‰§è¡Œè·¯å¾„ï¼š | - style-loader `pitch` | - css-loader `pitch` | - requested module is picked up as a dependency | - css-loader normal execution | - style-loader normal execution css-loader è¿”å›ç»“æœåˆ†æ css-loader åŠ è½½ css ä¹‹åï¼Œloader çš„ source å¦‚ä¸‹ï¼š // Imports var ___CSS_LOADER_API_IMPORT___ = require(\"../node_modules/css-loader/dist/runtime/api.js\"); var ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(function(i){return i[1]}); // Module ___CSS_LOADER_EXPORT___.push([module.id, \"nbody {n background: yellow;n}n\", \"\"]); // Exports module.exports = ___CSS_LOADER_EXPORT___; ä»è¿™ä¸ªç»“æœæ¥çœ‹ï¼Œåœ¨ style-loader ä¸­éœ€è¦å¯¹ source è¿›è¡Œ require æ¨¡å—å¯¼å…¥ï¼Œç„¶åæ‰èƒ½æ‹¿åˆ°å…¶ä¸­çš„ css åœ¨ loader ä¸­ require å¯¼å…¥å…¶ä»–æ¨¡å—ä¸è§„èŒƒ è¿‡ç¨‹å¾ˆå¤æ‚ æ‰€ä»¥é‡‡ç”¨ pitch çš„æ–¹å¼ pitch pitch å¯ä»¥æ‹¦æˆª loaderï¼Œpitch ä¸­ return ä¼šå¯¼è‡´åç»­çš„ loader ä¸æ‰§è¡Œ pitch çš„å†™æ³• module.exports.pitch = function (remainingRequest, precedingRequest, data) { remainingRequestï¼š å‰©ä¸‹çš„è¯·æ±‚ precedingRequestï¼šå·²å¤„ç†çš„è¯·æ±‚ dataï¼šæ•°æ® } style-loader é¦–å…ˆéœ€è¦æ‹¿åˆ° css-loader çš„å¤„ç†ç»“æœï¼š module.exports = function (remainingRequest) { const remainingPath = loaderUtils.stringifyRequest(this, `!!${remainingRequest}`) return ` import content from ${remainingPath} ` } è¿™æ ·å°±æ‹¿åˆ° css-loader å¤„ç†ä¹‹åçš„æ•°æ®äº†ã€‚å¦‚ä¸‹ï¼š [ 0: [ 0: \"./node_modules/css-loader/dist/cjs.js!./index.css\" 1: \"body { color: red}\", 2: \"\" ], i: (modules, mediaQuery, dedupe) => {}, length: 1 ] ä»è¿™ä¸ªæ•°æ®ä¸­ï¼Œå¯ä»¥çœ‹å‡ºï¼š0 å¯ä»¥ä½œä¸º idï¼Œ1 å¯ä»¥ä½œä¸ºcss æ¨¡å—çƒ­æ›´æ–°çš„å†™æ³• webpack.config.js ä¸­é…ç½® devServer devServer: { hot: true } æ¯ä¸ªéœ€è¦æ”¯æŒçƒ­æ›´æ–°çš„æ¨¡å—å£°æ˜ module.hot.accept if (module.hot) { module.hot.accept('./index.css', function () { console.log('halo! css changed') }) } å¯ä»¥çœ‹å‡ºæˆ‘ä»¬çš„ä»£ç ä¸­æ˜¯æ²¡æœ‰å£°æ˜ module.hot.accept çš„ï¼Œå¯æ˜¯ css å´æ”¯æŒçƒ­æ›´æ–°ï¼Œè¯´æ˜ loader ä¸­æ³¨å…¥äº†accept accept æ³¨å…¥ accept ä¸­é‡æ–°è·å–css if (module.hot) { module.hot.accept(remainingPath, function () { try { const newContent = require(remainingPath); // æ‹¿åˆ°æ–°çš„å†…å®¹ï¼Œé‡æ–°èµ°æ¸²æŸ“ injectStyle(newContent); } catch (e) { console.log('çƒ­æ›´æ–°å‘ç”Ÿé”™è¯¯ï¼š', e) } }) } è¿™é‡Œç”¨try catchåŒ…èµ·æ¥ï¼Œå› ä¸ºå¦‚æœè¿™ä¸ªå›è°ƒé‡ŒæŠ¥é”™ï¼Œwebpackä¼šèµ° reload å¯¼è‡´é¡µé¢åˆ·æ–° åˆ©ç”¨é—­åŒ… å“ªäº›å˜é‡ç”¨åˆ°äº†é—­åŒ…å‘¢ï¼šstyleInDomï¼Œupdaterï¼Œstyle function injectStyle (content) { for (let item of content) { const id = item[0]; const updater = styleInDom[id]; const css = item[1]; // å¦‚æœå·²ç»æ¸²æŸ“è¿‡ï¼Œæ‹¿åˆ° updater æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸­åˆ©ç”¨é—­åŒ…ç¼“å­˜äº† style èŠ‚ç‚¹ï¼Œæ›¿æ¢ style ä¸­å†…å®¹å³å¯ if (updater) { updater(css); } else { styleInDom[id] = addStyle(css) } } } function addStyle (css) { const style = ducument.createElement('style'); style.appendChild(document.createTextNode(css)); document.head.appendChild(style); return function updater (css) { if (css) { while (style.firstChild) { style.removeChild(style.firstChild); } style.appendChild(document.createTextNode(css)); } else { style.parentNode.removeChild(style); delete styleInDom[id] } } } è¿™é‡Œä¸ç®¡ç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼Œè¿˜æ˜¯ä¹‹åçš„çƒ­æ›´æ–°ï¼Œæ¯æ¬¡ injectStyle å°±è¡Œäº†ï¼Œä¼ å…¥ css-loader è½¬æ¢ä¹‹åçš„ç»“æœ æ€»ç»“ Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-11-19 18:03:03 "},"interview/webpack/8/1.html":{"url":"interview/webpack/8/1.html","title":"å¦‚ä½•è·å–loaderçš„é…ç½®å‚æ•°","keywords":"","body":"module çš„ä¸‰ç§é…ç½®æ–¹æ³• // æ–¹å¼ 1 | 2 { test: /\\.js$/, use | loader: 'myloader' | ['myloader'] } // æ–¹å¼ 3 { test: /\\.js$/, use: { loader: 'myloader', options: { name: 'xiur' } } } webpack é…ç½®æœ¬åœ° loader çš„å››ç§æ–¹æ³• æ–¹æ³•ä¸€ï¼š { test: /\\.js$/, loader: path.resolve(__dirname, './loader/myloader.js'), } æ–¹æ³•äºŒï¼š resolveLoader: { alias: { myLoader: path.resolve(__dirname, './loader/myloader.js'), } } æ–¹æ³•ä¸‰ï¼š resolveLoader: { modules: ['node_modules', path.resolve(__dirname, './loader')], } ç›®å½•ï¼šä¸¤ç§ç›®å½•éƒ½å¯ä»¥ ï½œ - node_modules | - myloader.js | - myloader | - index.js æ–¹æ³•å››ï¼š 4.1 åœ¨ loader ç›®å½•ä¸‹æ‰§è¡Œ npm link 4.2 å›åˆ°é¡¹ç›®ç›®å½•ä¸‹ æ‰§è¡Œ npm link myloader 4.3 åœ¨ webpack é…ç½®æ–‡ä»¶ä¸­ç›´æ¥ä½¿ç”¨ myloader å³å¯ loader-utils çš„ä½¿ç”¨ const loaderUtils = require('loader-utils'); getOptions è·å–é…ç½®çš„ options å‚æ•° loaderUtils.getOptions(this); parseQuery è·å– query å‚æ•°ï¼Œquery æ˜¯æ²¡åŠæ³•é…ç½®çš„ ä½¿ç”¨åœºæ™¯ï¼šimport content from './index.css?param1=xiur&param2=29' loaderUtils.parseQuery(this.resourceQuery) => { param1: 'xiur', param2: 29 } stringifyRequest 1. åˆ©ç”¨ remainingRequest å‚æ•°è·å– loader é“¾çš„å‰©ä½™éƒ¨åˆ† 2. åˆ©ç”¨ â€˜!!â€™ å‰ç¼€è·³è¿‡å…¶ä»– loader 2.1 ! è·³è¿‡ normal loader 2.2 -! è·³è¿‡ pre å’Œ normal loader 2.3 !! è·³è¿‡ preï¼Œnormal å’Œ post loader 3. loaderUtils çš„ stringifyRequest æ–¹æ³•å°†æ¨¡å—çš„ç»å¯¹è·¯å¾„è½¬ä¸ºç›¸å¯¹è·¯å¾„ loaderUtils.stringifyRequest(this, '!!' + remainingRequest) => !!../node_modules/css-loader/dist/cjs.js!./index.css ! -! !! é˜»æ–­ loader æ‰§è¡Œ urlToRequest convert that are root-relative URL into a module URl loaderUtils.urlToRequest('path/to/module.js') => './path/to/module.js' å•çº¯çš„è·¯å¾„æ‹¼æ¥ï¼š loaderUtils.urlToRequest(process.cwd(), '/loader/myloader.js') interpolateName const interpolatedName = loaderUtils.interpolateName(this, '[emoji:4].js', { content: source }); this.emitFile(interpolatedName, source); return `module.exports = '${JSON.stringify(interpolatedName)}'`; name å¯å¡«å‚æ•°ï¼š [ext] [name] [path] [folder] [query] [emoji] [emoji:] [contenthash] [hash] Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-11-18 11:20:34 "}}