{"./":{"url":"./","title":"Introduction","keywords":"","body":"Introduction Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-07-03 16:08:07 "},"knowledge/":{"url":"knowledge/","title":"çŸ¥è¯†æ˜Ÿçƒ","keywords":"","body":"çŸ¥è¯†æ˜ŸçƒğŸŒ è¿™é‡Œè®°å½•äº†å„ç§çŸ¥è¯†åˆ†ç±» Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-07-06 19:41:25 "},"knowledge/react/":{"url":"knowledge/react/","title":"React","keywords":"","body":"React Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-07-20 10:51:30 "},"knowledge/react/theory/":{"url":"knowledge/react/theory/","title":"ReactåŸç†","keywords":"","body":"ReactåŸç† Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-08-20 10:55:49 "},"knowledge/react/theory/1/1.html":{"url":"knowledge/react/theory/1/1.html","title":"Reactä¸­setStateåå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ","keywords":"","body":" è§£ç­” è°ƒç”¨setStateä¹‹åï¼Œä¼šç»å†ä¸€ä¸‹å‡ æ­¥ï¼š Reactä¼šå°†ä¼ å…¥çš„å‚æ•°å¯¹è±¡ä¸ç»„ä»¶å½“å‰çš„çŠ¶æ€åˆå¹¶ï¼Œç„¶åè§¦å‘æ‰€è°“çš„è°ƒå’Œè¿‡ç¨‹ ç»è¿‡è°ƒå’Œè¿‡ç¨‹ï¼ŒReactä¼šä»¥ç›¸å¯¹é«˜æ•ˆçš„æ–¹å¼æ ¹æ®æ–°çš„çŠ¶æ€æ„å»ºReactå…ƒç´ æ ‘å¹¶ä¸”ç€æ‰‹é‡æ–°æ¸²æŸ“æ•´ä¸ªUIç•Œé¢ åœ¨Reactå¾—åˆ°å…ƒç´ æ ‘ä¹‹åï¼ŒReactä¼šè‡ªåŠ¨è®¡ç®—å‡ºæ–°çš„æ ‘ä¸è€æ ‘çš„èŠ‚ç‚¹å·®å¼‚ï¼Œç„¶åæ ¹æ®å·®å¼‚å¯¹ç•Œé¢è¿›è¡Œæœ€å°åŒ–é‡æ¸²æŸ“ åœ¨å·®å¼‚è®¡ç®—ç®—æ³•ä¸­ï¼ŒReactèƒ½å¤Ÿç›¸å¯¹ç²¾ç¡®åœ°çŸ¥é“å“ªäº›ä½ç½®å‘ç”Ÿäº†æ”¹å˜ä»¥åŠåº”è¯¥å¦‚ä½•æ”¹å˜ï¼Œè¿™å°±ä¿è¯äº†æŒ‰éœ€æ›´æ–°ï¼Œè€Œä¸æ˜¯å…¨éƒ¨é‡æ–°æ¸²æŸ“ setStateä¸ºä»€ä¹ˆé»˜è®¤æ˜¯å¼‚æ­¥ å‡å¦‚æ‰€æœ‰setStateæ˜¯åŒæ­¥çš„ï¼Œæ„å‘³ç€æ²¡æ‰§è¡Œä¸€æ¬¡setSTateæ—¶ï¼Œéƒ½é‡æ–°vnode diff + domä¿®æ”¹ï¼Œè¿™å¯¹æ€§èƒ½æ¥è¯´æ˜¯æä¸ºä¸å¥½çš„ã€‚å¦‚æœæ˜¯å¼‚æ­¥ï¼Œåˆ™å¯ä»¥æŠŠä¸€ä¸ªåŒæ­¥ä»£ç ä¸­çš„å¤šä¸ªsetStateåˆå¹¶æˆä¸€æ¬¡ç»„ä»¶æ›´æ–°ã€‚ setStateä»€ä¹ˆæ—¶å€™æ˜¯åŒæ­¥ setTimeout åŸç”Ÿäº‹ä»¶ Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-07-20 11:17:01 "},"knowledge/react/theory/2/1.html":{"url":"knowledge/react/theory/2/1.html","title":"Reduxä¸­å¼‚æ­¥çš„è¯·æ±‚å¦‚ä½•å¤„ç†ï¼Ÿ","keywords":"","body":" è§£ç­” redux-thunk ç¬¬ä¸€æ­¥ï¼šé…ç½®redux-thunkï¼š import { createStore, applyMiddleware, compose } from 'redux' import thunk from 'redux-thunk' const enhancer = composeEnhancers(applymiddleware(thunk)) const store = createStore(reducer, enhancer) Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-07-20 15:56:26 "},"knowledge/react/theory/3/1.html":{"url":"knowledge/react/theory/3/1.html","title":"Reactç»„ä»¶ä¹‹é—´çš„é€šä¿¡æ–¹å¼","keywords":"","body":" è§£ç­” 1. çˆ¶ç»„ä»¶å‘è‡ªç»„ä»¶é€šä¿¡ - å±æ€§ä¼ é€’ 2. å­ç»„ä»¶å‘çˆ¶ç»„ä»¶é€šä¿¡ - å±æ€§æ–¹æ³•ä¼ é€’ 3. è·¨ç»„ä»¶é€šä¿¡ - å±æ€§ä¼ é€’ï¼Œä¼ é€’å±‚çº§è¾ƒæ·±å¢åŠ å¤æ‚åº¦ - ä½¿ç”¨context 4. æ²¡æœ‰åµŒå¥—å…³ç³»çš„ç»„ä»¶ - è‡ªå®šä¹‰äº‹ä»¶é€šä¿¡ï¼ˆå‘å¸ƒè®¢é˜…ï¼‰ - reduxç­‰å…¨å±€çŠ¶æ€ç®¡ç† - å…„å¼Ÿç»„ä»¶å¯ä»¥é€šä¿¡çˆ¶ç»„ä»¶é€šä¿¡ ä½¿ç”¨Contextè·¨ç»„ä»¶é€šä¿¡ const BatteryContext = createContext() { color => {} } Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-08-07 11:17:24 "},"knowledge/react/theory/4/1.html":{"url":"knowledge/react/theory/4/1.html","title":"React.createElementä¸»è¦åšäº†ä»€ä¹ˆï¼Ÿ","keywords":"","body":" ä¸ºä»€ä¹ˆä½¿ç”¨jsxçš„æ–‡ä»¶éƒ½éœ€è¦import Reactï¼Ÿ å› ä¸ºjsxä¼šè¢«è§£æä¸ºReact.createElementï¼ŒcreateElementæ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š typeï¼šdiv configï¼šèŠ‚ç‚¹å±æ€§ï¼Œè¯¸å¦‚classNameï¼Œidï¼Œkeyï¼Œref children æ¥çœ‹ä¸€ä¸ªç®€å•çš„JSXè¢«babelä¹‹åï¼š this.ref = ref} key={1}> Hello World React.createElement('div', { className: '111', id: 'leo', ref: ref => this.ref = ref, key: 1 }, 'Hello World') å¦‚æœHello Worldæ˜¯å¤šä¸ªå¤æ‚èŠ‚ç‚¹å‘¢ this.ref = ref} key={1}> Hello World1 Hello World2 React.createElement('div', { className: '111', id: 'leo', ref: ref => this.ref = ref, key: 1 }, React.createElement('div', null, 'Hello World1'), React.createElement('div', null, 'Hello World2'), ) ä»è¿™é‡Œçœ‹å‡ºcreateElementçš„ç¬¬ä¸‰ä¸ªå‚æ•°childrenå…¶å®æ˜¯ä¸ªä¸å®šå‚æ•° createElementçš„ä¸»è¦æµç¨‹ ä»configä¸­è·å–ä¿ç•™å­—æ®µkeyï¼Œrefï¼Œselfï¼Œ source é™¤äº†ä¿ç•™å­—æ®µï¼Œå…¶ä»–å±æ€§ä»configèµ‹å€¼åˆ°propsã€‚tipsï¼špropsä¸ºä½•ç‰©ï¼Ÿconst props = {} å¤„ç†ä¸å®šå‚æ•°childrenï¼Œé€šè¿‡argumentsï¼Œèµ‹å€¼åˆ°props.children è·å–type.defaultPropsï¼Œå½“props[propName]ä¸ºundefinedæ—¶è¿›è¡Œèµ‹å€¼ type.defaultPropsæ˜¯ä»€ä¹ˆï¼Ÿ æ™®é€šèŠ‚ç‚¹æ˜¯æ²¡æœ‰defaultPropsçš„ï¼Œåªæœ‰ç»„ä»¶æ‰ä¼šæœ‰ï¼Œå¦‚ä¸‹ï¼š class App extends React.Component { render () { return Hello World } } App.defaultProps = { name: 'leo' } createElementåŠŸèƒ½ createElementå…¶å®å°±æ˜¯ä¸ªåˆ›å»ºvirtual Domçš„å‡½æ•°Virtual Domçš„ç»“æ„æ˜¯æ€æ ·çš„ï¼Ÿ { $$typeof: 0xeac7, type: 'div' æˆ–è€… Appï¼Œ key: '1', ref: ref => this.ref = ref, props: { className: '111', id: 'leo', name: 'leo', children: [ { $$typeof: 0xeac7, type: 'div', props: { children: ['Hello World'] } } ] } } Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-08-12 11:37:19 "},"knowledge/react/theory/5/1.html":{"url":"knowledge/react/theory/5/1.html","title":"React Component","keywords":"","body":" Reactä¸­PureComponentçš„å®ç°ï¼š // ä»¥ä¸‹åšçš„éƒ½æ˜¯ç»§æ‰¿åŠŸèƒ½ï¼Œè®© PureComponent ç»§æ‰¿è‡ª Component function ComponentDummy() {} ComponentDummy.prototype = Component.prototype; function PureComponent(props, context, updater) { this.props = props; this.context = context; this.refs = emptyObject; this.updater = updater || ReactNoopUpdateQueue; } const pureComponentPrototype = (PureComponent.prototype = new ComponentDummy()); pureComponentPrototype.constructor = PureComponent; Object.assign(pureComponentPrototype, Component.prototype); // é€šè¿‡è¿™ä¸ªå˜é‡åŒºåˆ«ä¸‹æ™®é€šçš„ Component pureComponentPrototype.isPureReactComponent = true; Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-08-12 14:00:33 "},"knowledge/react/theory/6/1.html":{"url":"knowledge/react/theory/6/1.html","title":"React Refçš„å®ç°åŸç†","keywords":"","body":" refçš„ä¸‰ç§ç”¨æ³• stringæ¨¡å¼çš„å·²è¢«åºŸå¼ƒ 1. å›è°ƒå‡½æ•°æ¨¡å¼ ref = { el => this.el = el } 2. createRef this.ref = React.createRef() ref = {this.ref} 3. forwardRef React.forwardRef((props, ref) => ( )) createRef function createRef () { const refObject = { current: null } return refObject } Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-08-12 14:08:59 "},"knowledge/react/theory/7/1.html":{"url":"knowledge/react/theory/7/1.html","title":"React Childrençš„å®ç°ç»†èŠ‚","keywords":"","body":" React.Children.mapçš„ä¸»è¦åŠŸèƒ½ ä¸‰ä¸ªå‚æ•°ï¼šchildrenï¼Œfuncï¼Œcontext ä¸»è¦åŠŸèƒ½ï¼šä½¿ç”¨ä¸Šä¸‹æ–‡contextå¯¹æ¯ä¸ªchildrenæ‰§è¡Œfunc è¿”å›ç»“æœçš„ç‰¹æ®Šå¤„ç†ï¼Œè¿”å›ç»“æœæ˜¯æ•°ç»„ï¼Œæ‹å¹³ å¦‚ä½•æ‹å¹³ï¼Ÿéå†æ¯ä¸€é¡¹æ‰§è¡ŒmapIntoWithKeyPrefixInterval ä¸¤ä¸ªé—®é¢˜ React.Children.mapçš„ç¬¬ä¸€ä¸ªå‚æ•°childrenå…è®¸å“ªå‡ ç§ç±»å‹ï¼Ÿ ä¸ºä»€ä¹ˆæ‰§è¡Œå®Œå›è°ƒçš„ç»“æœmappedChildï¼Œåˆ¤æ–­æ˜¯è¿˜è¦è¿›è¡ŒmapIntoWithKeyPrefixInternal è§£ç­” React.Children.map å°±æ˜¯ReacChildren.jsä¸­çš„mapChildrenå‡½æ•°ï¼Œä¸»è¦æµç¨‹å¦‚ä¸‹ï¼š mapChildrenå‡½æ•°ï¼š 1. å®šä¹‰resultï¼Œconst result = [] 2. mapIntoKeyPrefixInternal(children, result, null, func, context) 3. è¿”å›result mapIntoKeyPrefixInternalå‡½æ•°ï¼š 1. ç”Ÿæˆcontextï¼šgetPooledTraverseContext { result: [], keyprefix: '', func: func, context: null, count: 0 } 2. traverseAllChildrenImpl éå†childrenæ‰§è¡Œfunc 3. é‡Šæ”¾contextï¼šreleaseTraverseContext 3.1 æŠŠcontextä¸‹çš„å±æ€§éƒ½ç½®ä¸ºnullï¼Œcountç½®ä¸º0 3.2 æŠŠcontextæ”¾å…¥traverseContextPoolï¼Œä¸Šä¸‹æ–‡æ± sizeä¸º10 traverseAllChildrenImplå‡½æ•°ï¼š 1. childrenä¸ºstringï¼Œnumberæ—¶ï¼šè¡¨ç¤ºæ˜¯æ–‡æœ¬èŠ‚ç‚¹ 2. childrenä¸ºobjectç±»å‹ï¼Œchildren.$$typeofä¸ºREACT_ELEMENT_TYPEï¼ŒREACT_PORTAL_TYPEï¼Œè¯´æ˜æ˜¯å¯ä»¥æ¸²æŸ“çš„èŠ‚ç‚¹ 3. ä»¥ä¸Šå››ç§æƒ…å†µè¯æ˜childrenæ˜¯å¯æ¸²æŸ“çš„èŠ‚ç‚¹ï¼Œç›´æ¥æ‰§è¡ŒmapSingleChildIntoContext 4. childrenæ˜¯æ•°ç»„ï¼Œéå†childrenï¼Œå¯¹æ¯ä¸ªå…ƒç´ æ¥ä¸€æ¬¡traverseAllChildrenImpl 5. childrenæ˜¯å¯è¿­ä»£æ•°æ®ï¼Œè°ƒç”¨Symbol.iteratorï¼Œå¯¹æ¯ä¸ªå…ƒç´ æ¥ä¸€æ¬¡traverseAllChildrenImpl 6. childrenæ˜¯objectï¼Œæ”¾å¼ƒï¼Œéæ³•æ•°æ®è­¦å‘Š mapSingleChildIntoContextå‡½æ•°ï¼š 1. è·å–æ•°æ®ï¼šconst { result, keyPrefix, func, context } = bookKeeping 2. æ‰§è¡Œå›è°ƒï¼šlet mappedChild = func.call(context, child, bookKeeping.count++) 3. åˆ¤æ–­ç»“æœmappedChildæ˜¯æ•°ç»„ï¼Œä»mapIntoKeyPrefixInternalå¯¹æ¯ä¸€é¡¹å†èµ°ä¸€é 4. mappedChildä¸æ˜¯æ•°ç»„ï¼Œresult.push(mappedChild) ä¸ºä»€ä¹ˆåœ¨æ‰§è¡Œå®Œfuncå›è°ƒæ‹¿åˆ°mappedChildï¼Œè¿˜è¦å¯¹å…¶å¤„ç† å› ä¸ºReactéœ€è¦å¯¹å…¶è¿›è¡Œæ‹å¹³ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ç§åœºæ™¯ï¼š React.Children.map(this.props.children, child => [child, child]) è¿™ç§æƒ…å†µå¦‚æœChildrenæ˜¯[div1, div2]ï¼Œmapä¹‹åçš„ç»“æœä¸º[div1, div1, div2, div2] æ€§èƒ½ä¼˜åŒ–ç‚¹ const POOL_SIZE = 10; const traverseContextPool = []; function getPooledTraverseContext( mapResult, keyPrefix, mapFunction, mapContext, ) { if (traverseContextPool.length) { const traverseContext = traverseContextPool.pop(); traverseContext.result = mapResult; traverseContext.keyPrefix = keyPrefix; traverseContext.func = mapFunction; traverseContext.context = mapContext; traverseContext.count = 0; return traverseContext; } else { return { result: mapResult, keyPrefix: keyPrefix, func: mapFunction, context: mapContext, count: 0, }; } } function releaseTraverseContext(traverseContext) { traverseContext.result = null; traverseContext.keyPrefix = null; traverseContext.func = null; traverseContext.context = null; traverseContext.count = 0; if (traverseContextPool.length æä¸€ä¸ªtraverseContextPoolæ± å­ï¼Œå­˜å‚¨traverseContextå¯¹è±¡ï¼Œå°±ä¸ç”¨é¢‘ç¹åˆ›å»ºä¸€ä¸ªæœ‰å¾ˆå¤šå±æ€§çš„å¯¹è±¡ï¼Œå¾ˆæ¶ˆè€—æ€§èƒ½ Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-08-13 10:50:19 "},"knowledge/react/theory/8/1.html":{"url":"knowledge/react/theory/8/1.html","title":"React Fiber","keywords":"","body":" Fiberå‡ºç°çš„èƒŒæ™¯ Stack reconcilerçš„å·¥ä½œæµç¨‹å¾ˆåƒå‡½æ•°çš„è°ƒç”¨è¿‡ç¨‹ã€‚ çˆ¶ç»„ä»¶é‡Œè°ƒç”¨å­ç»„ä»¶ï¼Œå¯ä»¥ç±»æ¯”ä¸ºå‡½æ•°çš„å‡ºé€’å½’ å¯¹äºç‰¹åˆ«åºå¤§çš„vDOMæ ‘æ¥è¯´ï¼Œreconcilerè¿‡ç¨‹ä¼šå¾ˆé•¿ï¼Œè¶…è¿‡16ms reconcileræœŸé—´ï¼Œä¸»çº¿ç¨‹æ˜¯è¢«jså ç”¨çš„ï¼Œå› ä¸ºä»»ä½•äº¤äº’ï¼Œå¸ƒå±€ï¼Œæ¸²æŸ“éƒ½ä¼šåœæ­¢ï¼Œç»™ç”¨æˆ·å¡äº†çš„æ„Ÿè§‰ Reactåœ¨è¿›è¡Œç»„ä»¶æ¸²æŸ“æ—¶ï¼Œä»setStateåˆ°æ¸²æŸ“å®Œæˆæ•´ä¸ªè¿‡ç¨‹æ˜¯åŒæ­¥çš„ å¦‚æœæ¸²æŸ“çš„ç»„ä»¶æ¯”è¾ƒå¤§ï¼Œjsæ‰§è¡Œä¼šå æ®ä¸»çº¿ç¨‹äº‹ä»¶æ¯”è¾ƒé•¿ï¼Œå¯¼è‡´reactåœ¨åŠ¨ç”»ï¼Œæ‰‹åŠ¿ç­‰åº”ç”¨ä¸­æ•ˆæœæ¯”è¾ƒå·® Fiberå®ç°åŸç† å®ç°è‡ªå·±çš„ç»„ä»¶è°ƒç”¨æ ˆï¼Œä»¥é“¾è¡¨çš„å½¢å¼éå†ç»„ä»¶æ ‘ï¼Œå¯ä»¥çµæ´»çš„æš‚åœï¼Œç»§ç»­å’Œä¸¢å¼ƒæ‰§è¡Œçš„ä»»åŠ¡ã€‚ Fiberå…¶å®æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼š const fiber = { stateNode, child, sibling, return, } Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-08-13 17:38:44 "},"knowledge/react/theory/9/1.html":{"url":"knowledge/react/theory/9/1.html","title":"Reactå¦‚ä½•è‡ªå®šä¹‰å®ç°requestIdleCallback","keywords":"","body":" ä¸ºä»€ä¹ˆReactæ”¾å¼ƒä½¿ç”¨åŸç”ŸrequestIdleCallback? äº†è§£å‡ ä¸ªåç§°ï¼šFPSï¼šframe per secondï¼Œæ¯ç§’çš„å¸§æ•° å¸§çš„å‡ ä¸ªé—®é¢˜ setTimeout(callback) å’Œ setInterval(callback) å®ç°åŸç† reactä½¿ç”¨requestAnimationFrame + MessageChannel å®ç°requestIdleCallbackçš„polyfillç‰ˆæœ¬ï¼š let frameDeadline let activeFrameTime = 16 let channel = new MessageChannel() let port = channel.port2 channel.port1.onmessage = () => { const currentTime = performance.now() console.log('å½“å‰æ—¶é—´:', currentTime) console.log('å½“å‰å¸§å‰©ä½™æ—¶é—´:', frameDeadline - currentTime) } const startTime = performance.now() const requestAnimationFrameCircle = () => { requestAnimationFrame(timestamp => { frameDeadline = timestamp + activeFrameTime port.postMessage(undefined) if (performance.now() - startTime Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-08-31 20:22:13 "},"knowledge/react/theory/10/":{"url":"knowledge/react/theory/10/","title":"hookså®ç°åŸç†","keywords":"","body":"hooks åŸç† Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-09-14 11:02:45 "},"knowledge/react/theory/10/1/1.html":{"url":"knowledge/react/theory/10/1/1.html","title":"useStateå®ç°","keywords":"","body":"useStateå®ç° useStateçš„ä½¿ç”¨ function App () { const [count, setCount] = React.useState(0); return {count} setCount(count + 1)}>å¢åŠ  } useStateè‡ªå®šä¹‰å®ç° let hookStates = [] let hookIndex = 0 function useState (initialState) { hookStates[hookIndex] = hookStates[hookIndex] || initialState const currentIndex = hookIndex function setState (newState) { hookStates[currentIndex] = newState render() } return [hookStates[hookIndex++], setState] } Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-09-14 15:36:19 "},"knowledge/react/theory/10/2/1.html":{"url":"knowledge/react/theory/10/2/1.html","title":"useMemoå®ç°","keywords":"","body":"useMemoçš„å®ç° useMemoçš„ä½œç”¨ï¼šæ ¹æ®ä¾èµ–é¡¹è¿”å›ä¸€ä¸ªè®°å¿†å€¼ï¼Œåªæœ‰ä¾èµ–é¡¹æ”¹å˜æ‰ä¼šè§¦å‘useMemoå›è°ƒuseMemoçš„ä½¿ç”¨ function App () { const [count, setCount] = React.useState(0) const [name, setName] = React.useState('xuqiang') const memoized = React.useMemo(() => { console.log('get memoized value') return name + count }, [name, count]); return setName(e.target.value)} /> setCount(count + 1)}>å¢åŠ  } useMemoçš„å®ç°ï¼š function useMemo (callback, dependencies) { if (hookStates[hookIndex]) { const [memoizedVal, oldDependencies] = hookStates[hookIndex] const isDependencySame = dependencies.every((dependency, idx) => dependency === oldDependencies[idx]) if (isDependencySame) { hookIndex++ return memoizedVal } else { const memoizedVal = callback() hookStates[hookIndex++] = [memoizedVal, dependencies] return memoizedVal } } else { const memoizedVal = callback() hookStates[hookIndex++] = [memoizedVal, dependencies] return memoizedVal } } è¿™é‡Œä¼šæœ‰ä¸ªé—®é¢˜æ˜¯ï¼šhookIndexè‡ªå¢ä¹‹åï¼Œæ¯æ¬¡hookStates[hookIndex]åº”è¯¥éƒ½æ˜¯undefinedè¿™é‡Œæ˜¯ä¸ªè¯¯åŒºï¼šuseMemoåªä¼šè¿›ä¸€æ¬¡ï¼ŒhookStateså’ŒhookIndexåªæ˜¯ä¿å­˜äº†å½“å‰ç»„ä»¶ä¸­çš„å„ä¸ªhookï¼Œå¦‚æœç‚¹å‡»ç­‰å¯¼è‡´ç»„ä»¶è¢«é‡æ–°æ¸²æŸ“ï¼Œé‚£ä¹ˆå¾—ä¿è¯hookIndexè¢«é‡ç½® Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-09-14 17:14:18 "},"knowledge/react/theory/10/3/1.html":{"url":"knowledge/react/theory/10/3/1.html","title":"useCallbackå®ç°","keywords":"","body":"useCallbackå®ç° useCallbackçš„ä½¿ç”¨ï¼šå‡½æ•°å¥æŸ„çš„æ”¹å˜ä¼šå¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼ŒuseCallbackå¯ä»¥ä½¿å¥æŸ„ä¿æŒä¸å˜ï¼Œç»“åˆReact.memoå¯ä»¥é¿å…è‡ªç»„ä»¶ä¸å¿…è¦çš„æ¸²æŸ“ function Child (props) { console.log('Child init') return Submit } Child = React.memo(Child) function App () { const [count, setCount] = React.useState(0) const [name, setName] = React.useState('xuqiang') const onButtonClick = React.useCallback(() => { console.log('callback is executed') }, [name]) return setName(e.target.value)} /> setCount(count + 1)}>å¢åŠ  } useCallbackè‡ªå®šä¹‰å®ç° function useCallback (callback, dependencies) { if (hookStates[hookIndex]) { const [oldCallback, oldDependencies] = hookStates[hookIndex] const isDependencySame = dependencies.every((dependency, idx) => dependency === oldDependencies[idx]) if (isDependencySame) { hookIndex++ return oldCallback } else { hookStates[hookIndex++] = [callback, dependencies] return callback } } else { hookStates[hookIndex++] = [callback, dependencies] return callback } } useCallbackçš„å®ç°å’ŒuseMemoçš„å®ç°å·®ä¸å¤š Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-09-14 17:17:17 "},"knowledge/react/theory/10/4/1.html":{"url":"knowledge/react/theory/10/4/1.html","title":"useEffectå®ç°","keywords":"","body":"useEffectå®ç° useEffectçš„ä½¿ç”¨ function App () { const [count, setCount] = React.useState(0) const [name, setName] = React.useState('xuqiang') React.useEffect(() => { console.log('effect executed') }, [name, count]) return setName(e.target.value)} /> setCount(count + 1)}>å¢åŠ  } useEffectçš„æ‰§è¡Œæ—¶æœºï¼š componentDidMount componentDidUpdate useEffectçš„å®ç°ï¼š function useEffect (callback, dependencies) { if (hookStates[hookIndex]) { const oldDependencies = hookStates[hookIndex] const isDependencySame = dependencies.every((dependency, idx) => dependency === oldDependencies[idx]) if (isDependencySame) { hookIndex++ } else { hookStates[hookIndex++] = dependencies callback() } } else { hookStates[hookIndex++] = dependencies callback() } } useEffectçš„å®ç°è·ŸuseMemoå¾ˆç›¸ä¼¼ Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-09-14 17:33:06 "},"knowledge/react/theory/10/5/1.html":{"url":"knowledge/react/theory/10/5/1.html","title":"React.memoçš„å®ç°","keywords":"","body":"React.memoçš„å®ç° React.memoçš„ä½œç”¨ï¼špropsæ”¹å˜äº†è§¦å‘æ¸²æŸ“ï¼Œpropsæœªå˜ï¼Œå­ç»„ä»¶ä¸ä¼šé‡æ–°æ¸²æŸ“ React.memo = innerComponent => { return class extends React.PureComponent { render () { return } } } Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-09-14 17:39:05 "},"knowledge/react/theory/10/6/1.html":{"url":"knowledge/react/theory/10/6/1.html","title":"useContextå®ç°","keywords":"","body":"useContextå®ç° useContextçš„ä½¿ç”¨ï¼šéç›´æ¥ç»„ä»¶æ•°æ®ä¼ è¾“ const Context = React.createContext() function Child () { const context = React.useContext(Context) return {context.name} } function App () { const [count, setCount] = React.useState(0) const [name, setName] = React.useState('xuqiang') return setName(e.target.value)} /> setCount(count + 1)}>å¢åŠ  } useContextçš„å®ç°ï¼š function useContext (Context) { return Context._currentValue } React.createContextè¿”å›çš„Contextçš„ç»“æ„ï¼š $$typeof: Symbol(react.context), _currentValue: undefined Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-09-14 17:48:31 "},"knowledge/html/":{"url":"knowledge/html/","title":"Html","keywords":"","body":"Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-07-06 19:45:28 "},"knowledge/html/1/1.html":{"url":"knowledge/html/1/1.html","title":"Htmlå¸ƒå±€å…ƒç´ çš„åˆ†ç±»æœ‰å“ªäº›","keywords":"","body":"Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-09-07 11:16:43 "},"knowledge/html/2/1.html":{"url":"knowledge/html/2/1.html","title":"èµ„æºé¢„åŠ è½½çš„å¤„ç†æ–¹å¼","keywords":"","body":" preload link rel href aså®ç°æ–‡ä»¶çš„é¢„åŠ è½½ asçš„å–å€¼ï¼š audioï¼šéŸ³é¢‘æ–‡ä»¶ documentï¼šåµŒå…¥frameæˆ–iframeå†…éƒ¨çš„æ–‡æ¡£ embedï¼šåµŒå…¥embedå…ƒç´ å†…éƒ¨çš„èµ„æº fetchï¼šå°†é€šè¿‡fetchæˆ–ajaxè¯·æ±‚è·å–çš„èµ„æºï¼Œå¦‚jsonæ–‡ä»¶æˆ–ArrayBuffer fontï¼šå­—ä½“æ–‡ä»¶ imageï¼šå›¾ç‰‡æ–‡ä»¶ objectï¼šåµŒå…¥embedå…ƒç´ å†…çš„æ–‡ä»¶ scriptï¼šjsæ–‡ä»¶ styleï¼šæ ·å¼è¡¨ workerï¼šä¸€ä¸ªjsçš„web workeræˆ–shared worker videoï¼šè§†é¢‘æ–‡ä»¶ prefetch relä¸ºprefetchæ—¶ï¼Œè¡¨ç¤ºä¸‹è½½èµ„æºä¸ºä¸‹ä¸€ä¸ªå¯¼èˆª/é¡µé¢ä½¿ç”¨ Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-09-07 11:38:24 "},"knowledge/html/3/1.html":{"url":"knowledge/html/3/1.html","title":"FP, FCP, TTI, FMP","keywords":"","body":" åè¯è§£é‡Š FPï¼šfirst paint FCPï¼šfirst content paint TTIï¼štime to interactive FMPï¼šfirst meaningful paint LCPï¼šlargest contentful paint FIDï¼šfirst input delay è·Ÿè¸ªFP/FCP const observer = new PerformanceObserver(list => { for (const entry of list.getEntries()) { const metricName = entry.name const time = Math.round(entry.startTime + entry.duration) console.log('entry: ', entry) } }) observer.observe({ entryTypes: ['paint'] }) è¿½è¸ªLCP æœ€å¤§å†…å®¹ç»˜åˆ¶ï¼šæµè§ˆå™¨è‡ªå·±åˆ¤æ–­ const observer = new PerformanceObserver(list => { for (let entry of list.getEntries()) { console.log(entry) } }) observer.observe({ type: 'largest-contentful-paint' }) è¿½è¸ªFMP el.setAttribute('elementimg', 'meaningful') const observer = new PerformanceObserver(list => { for (let entry of list.getEntries()) { console.log(entry) } }) observer.observe({ type: 'element' }) FMPçš„entryç»“æœæ˜¯ï¼š entryType: \"element\" identifier: \"meaning\" è·Ÿè¸ªTTI google chromeæœ‰ä¸ªåº“ï¼štti-polyfillï¼Œå¯ä»¥å€ŸåŠ©è¿™ä¸ªåº“æ”¶é›†tti è·Ÿè¸ªFIDï¼šç¬¬ä¸€æ¬¡è¾“å…¥å»¶è¿Ÿ const firstHiddenTime = document.visibilityState === 'hidden' ? 0 : Infinity document.addEventListener('visibilitychange', event => { firstHiddenTime = Math.min(firstHiddenTime, event.timeStamp) }) const observer = new PerformanceObserver(list => { for (let entry of list.getEntries()) { if (entry.startTime è·Ÿè¸ªé•¿ä»»åŠ¡ entryTypes: ['longtask'] è·Ÿè¸ªè¾“å…¥å»¶è¿Ÿ btn.addEventListener('click', event => { const lag = performance.now() - event.timeStamp; if (lag > 100) { console.log('è¾“å…¥å»¶è¿Ÿ') } }) è®¡ç®—ç”¨æˆ·çš„é€—ç•™æ—¶é•¿ ä½¿ç”¨documentçš„visibilitychangeäº‹ä»¶æ¥è§¦å‘æµè§ˆå™¨æ ‡ç­¾é¡µéšè—å’Œæ˜¾ç¤ºçš„å›è°ƒ paintå¯ä»¥è·å–ä¸¤ä¸ªæŒ‡æ ‡ name: 'first-paint' name: 'first-contentful-paint' entryå¯¹è±¡ä¸­æœ‰entryType, startTime, duration, nameå››ä¸ªå±æ€§ entryTypeæœ‰å“ªäº› frameï¼Œnavigation resource mark measure paint navigator.sendBeaconå­˜åœ¨çš„æ„ä¹‰ ç½‘é¡µåœ¨unloadæˆ–è€…beforeunloadä¹‹å‰æƒ³è¦æ”¶é›†äº›æ•°æ®ï¼šæ¯”å¦‚é€—ç•™æ—¶é—´ç­‰ä½¿ç”¨xhrå‘é€æ•°æ®çš„é—®é¢˜ï¼š åŒæ­¥è¯·æ±‚ä¼šå¯¼è‡´å»¶è¿Ÿç½‘é¡µå…³é—­ å¼‚æ­¥è¯·æ±‚ä¼šå¯¼è‡´ç½‘é¡µå…³é—­æœ‰äº›è¯·æ±‚æœªå‘å‡º ``` // åŒæ­¥è¯·æ±‚å¯¼è‡´ç½‘é¡µå…³é—­å»¶è¿Ÿ const xhr = new XMLHttpRequest() xhr.send('POST', url, false) // navigator.sendBeaconå°±æ˜¯ä¸ºè§£å†³è¿™ç§åœºæ™¯è€Œç”Ÿ navigator.sendBeacon('/log', analyticsData) ``` Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-09-10 14:25:16 "},"knowledge/html/4/1.html":{"url":"knowledge/html/4/1.html","title":"HTMLæ ‡ç­¾åˆæ³•æ€§åŠç›¸å…³æ“ä½œ","keywords":"","body":" ç»Ÿè®¡ Copyright Â© qiangxu@clubfactory.com 2020 all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ç« ä¿®è®¢æ—¶é—´ï¼š 2020-09-16 17:03:53 "}}